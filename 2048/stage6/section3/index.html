<html lang="ja">
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-166967736-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-166967736-1');
    </script>

    <title>Pythonプログラミングで2048を作る　6-3</title>
    
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta property="og:url" content="https://Saito-Saito-Saito.github.io/2048/stage6/section3">
    <meta property="og:title" content="Pythonプログラミングで2048を作る　6-3">
    <meta name="og:description" content="Pythonプログラミングによって、ターミナル上で実行できる2048を制作します。ここではゲームをいかに進行するか、そのアルゴリズムを実装します。">
    <meta name="description" content="Pythonプログラミングによって、ターミナル上で実行できる2048を制作します。ここではゲームをいかに進行するか、そのアルゴリズムを実装します。">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="twitter:card" content="summary_large_image"/>
    <meta property="og:image" content="https://Saito-Saito-Saito.github.io/unagi-study.JPG">

    <link rel="icon" href="https://Saito-Saito-Saito.github.io/icon.png">
    <link rel="stylesheet" href="../../stylesheet.css">
</head>
<body>
    <header>
        <div id="title">
            <h1>Pythonプログラミングで</h1>
            <h1>2048を作る</h1>
        </div>
    </header>

    <div id="menu-bar">
        <div id="short-menu">
            <input type="checkbox" id="acd-check">
            <table>
                <tr><td><a href="https://Saito-Saito-Saito.github.io/chess">HOME</a></td><td><label for="acd-check">STAGES</label></td><td><a href="https://Saito-Saito-Saito.github.io/2048/code">CODE</a></td>
                </tr>
            </table>
            <ul class="stages-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage1">Stage 1　プログラムの機能を考える</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage2">Stage 2　プログラムの土台を作る</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage3">Stage 3　盤面のクラスの基本機能を作る</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage4">Stage 4　盤面を動かす</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage5">Stage 5　ゲームの終了を判定する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage6">Stage 6　ゲーム進行を実装する</a></li>
            </ul>
        </div>
        <div id="long-menu">
            <table>
                <tr>
                    <td><a href="https://Saito-Saito-Saito.github.io/chess/">HOME</a></td>
                    <td><label for="acd-check1">Stage 1</label></td>
                    <td><label for="acd-check2">Stage 2</label></td>
                    <td><label for="acd-check3">Stage 3</label></td>
                    <td><label for="acd-check4">Stage 4</label></td>
                    <td><label for="acd-check5">Stage 5</label></td>
                    <td><label for="acd-check6">Stage 6</label></td>
                    <td><a href="https://Saito-Saito-Saito.github.io/2048/code">CODE</a></td>
                </tr>
            </table>
            <input type="checkbox" id="acd-check1" class="acd-check">
            <ul id="s1-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage1">Stage 1　プログラムの機能を考える</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage1/section1">1-1　盤面の機能を考える</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage1/section2">1-2　動きの機能を考える</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage1/section3">1-3　ゲーム進行の機能を考える</a></li>
            </ul>
            <input type="checkbox" id="acd-check2" class="acd-check">
            <ul id="s2-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage2">Stage 2　プログラムの土台を作る</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage2/section1">2-1　ロガーを設定する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage2/section2">2-2　定数を設定する</a></li>
            </ul>
            <input type="checkbox" id="acd-check3" class="acd-check">
            <ul id="s3-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage3">Stage 3　盤面のクラスの基本機能を作る</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage3/section1">3-1　新しい数を挿入する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage3/section2">3-2　コンストラクタを作る</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage3/section3">3-3　インデックスが適正か判断する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage3/section4">3-4　盤面を表示する</a></li>
            </ul>
            <input type="checkbox" id="acd-check4" class="acd-check">
            <ul id="s4-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage4">Stage 4　盤面を動かす</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage4/section1">4-1　概観を把握する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage4/section2">4-2　4 通りの場合わけをして盤面を動かす</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage4/section3">4-3　場合わけを統合したメソッドを実装する</a></li>
            </ul>
            <input type="checkbox" id="acd-check5" class="acd-check">
            <ul id="s5-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage5">Stage 5　ゲームの終了を判定する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage5/section1">5-1　ゲームクリアを判定する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage5/section2">5-2　手詰まりを判定する</a></li>
            </ul>
            <input type="checkbox" id="acd-check6" class="acd-check">
            <ul id="s6-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage6">Stage 6　ゲーム進行を実装する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage6/section1">6-1　ゴールやサイズの設定を変更する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage6/section2">6-2　スタートメニューを実装する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage6/section3">6-3　ゲーム進行を実装する</a></li>
            </ul>
        </div>
    </div>

    <main>
        <section id="s6-3">
            <h1>Stage 6　ゲーム進行を実装する</h1>
            <h2>6-3　ゲーム進行を実装する</h2>
            <section class="sub-section">
                <p>さあ、最後のチャプターです。</p>
                <div class="unagi">
                    <img src="../../unagi-pink800000/sweat.JPG" alt="">
                    <div class="balloon">
                        <p>長かった...</p>
                    </div>
                </div>
                <p>あともう一踏ん張りですよ。</p>
                <div class="real-code">
                    <pre>
                        <code>
if __name__ == "__main__":
    startmenu()
    main_board = board.Board(size=parameters['size'], goal=parameters['goal'])
    main_board.print()

    while True:
        input_d = input('DIRECTION: UP-1, DOWN-2, LEFT-3, RIGHT-4 : ')
        logger.debug('input_d = {}'.format(input_d))
        if input_d in ['1', 'w', 'W']:
            direction = UP
        elif input_d in ['2', 's', 'S']:
            direction = DOWN
        elif input_d in ['3', 'a', 'A']:
            direction = LEFT
        elif input_d in ['4', 'd', 'D']:
            direction = RIGHT
        else:
            print('INVALID INPUT')
            continue
        if main_board.move(direction) == FAILED:
            print('INVALID DIRECTION')
            continue
        if main_board.insert() == FAILED or main_board.isOver():
            main_board.print()
            print('GAME OVER...')
            break
        if main_board.isGoal() == True:
            main_board.print()
            print('You WIN!')
            break
        main_board.print()
        

    logger.info('end')
                        </code>
                    </pre>
                </div>
                <div class="unagi">
                    <img src="../../unagi-pink800000/sweat.JPG" alt="">
                    <div class="balloon">
                        <p>まだ長かった...</p>
                    </div>
                </div>
                <p>そんな、あとわずかじゃないですか。</p>
            </section>
            <p class="snake-line">~~~~~~~~~~~~~~~</p>
            <section class="sub-section">
                <p>最初に <a href="../section2/index.html" target="_new">6-2</a> で実装した startmenu を実行します。</p>
                <div class="real-code">
                    <pre>
                        <code>
if __name__ == "__main__":
    <span style="font-weight: bold;">startmenu()</span>
    main_board = board.Board(size=parameters['size'], goal=parameters['goal'])
    main_board.print()
                        </code>
                    </pre>
                </div>
                <p>この関数の中で初期設定の変更も済ませられるので、サイズやゴールは parameters をそのまま使って構いません。早速盤面の<a href="https://Saito-Saito-Saito.github.io/memorandom/Python/class#instance_v" class="memo" target="_new">インスタンス</a>を宣言しましょう。</p>
                <div class="real-code">
                    <pre>
                        <code>
if __name__ == "__main__":
    startmenu()
    <span style="font-weight: bold;">main_board = board.Board(size=parameters['size'], goal=parameters['goal'])</span>
    main_board.print()
                        </code>
                    </pre>
                </div>
                <p><a href="https://Saito-Saito-Saito.github.io/memorandom/Python/class#instance_v" class="memo" target="_new">インスタンス</a>を宣言したらまずは盤面を表示します。どこにどんな数字があるかもわからないのに「早く動かせ」って言われてもしょうがないでしょ？</p>
                <p>もしスタート画面で下手に設定を弄らなければ、画面全体はこの時点でこのようになっています。</p>
                <img src="till-start-board.png" alt="UNAVAILABLE" width="90%" style="max-width: 450px;">
            </section>
            <p class="snake-line">~~~~~~~~~~~~~~~</p>
            <section class="sub-section">
                <p>さて、ここからは while ループでゴールするかゲームオーバーになるまで同じことを繰り返し続けます。</p>
                <p>まずはプレーヤーに盤面を動かす方向を指示してもらいましょう。</p>
                <div class="real-code">
                    <pre>
                        <code>
    while True:
        <span style="font-weight: bold;">input_d = input('DIRECTION: UP-1, DOWN-2, LEFT-3, RIGHT-4 : ')</span>
        logger.debug('input_d = {}'.format(input_d))
                        </code>
                    </pre>
                </div>
                <p>無難に 1 ~ 4 の数字で聞いていますが、裏コマンドとして W/S/D/A のキーでも扱えるようにしています。左手の矢印キー機能ですね。</p>
                <img src="keyboard.jpg" alt="UNAVAILABLE" width="90%" style="max-width: 200px;">
                <p>各方向で場合わけして direction を決めていきます。</p>
                <div class="real-code">
                    <pre>
                        <code>
        if input_d in ['1', 'w', 'W']:
            direction = UP
        elif input_d in ['2', 's', 'S']:
            direction = DOWN
        elif input_d in ['3', 'a', 'A']:
            direction = LEFT
        elif input_d in ['4', 'd', 'D']:
            direction = RIGHT
        else:
            print('INVALID INPUT')
            continue
                        </code>
                    </pre>
                </div>
                <p>正規外の入力があったら</p>
                <div class="unagi">
                    <img src="../../unagi-pink800000/dangerous.JPG" alt="">
                    <div class="balloon">
                        <p>無理だっつってんだろうが、アァ？</p>
                    </div>
                </div>
                <p>と毅然とした態度でつっぱねてください。</p>
            </section>
            <p class="snake-line">~~~~~~~~~~~~~~~</p>
            <section class="sub-section">
                <p>次いで、入力してもらった方向に move <a href="https://Saito-Saito-Saito.github.io/memorandom/Python/class#method_v" class="memo" target="_new">メソッド</a>を発動します。</p>
                <div class="real-code">
                    <pre>
                        <code>
        if <span style="font-weight: bold;">main_board.move(direction)</span> == FAILED:
            print('INVALID DIRECTION')
            continue
                        </code>
                    </pre>
                </div>
                <p>FAILED「失敗」したらその向きには盤面を動かせないわけですから、「入力がやっぱりおかしい」と言ってつっぱねてあげましょう。while ループを continue してください。</p>
                <div class="unagi">
                    <img src="../../unagi-pink800000/question.JPG" alt="">
                    <div class="balloon">
                        <p>これでちゃんと move 発動しとるんか？</p>
                    </div>
                </div>
                <p>してますよ。if 文の条件を確認する時に move の返り値をみているわけですが、返り値を得るには必ず move を実行しなければいけませんから。</p>
                <p>新しい数を入れられなかったり、ゲームオーバーが確定していたら、盤面を表示して「ゲームオーバーです」と言って while ループを抜けます。</p>
                <div class="real-code">
                    <pre>
                        <code>
        if main_board.insert() == FAILED or main_board.isOver():
            main_board.print()
            print('GAME OVER...')
            break
                        </code>
                    </pre>
                </div>
                <p>またゴールしていたら「ゲームクリア」ということで盤面を表示してプレーヤーをたたえてあげましょう。こちらも break してください。</p>
                <div class="real-code">
                    <pre>
                        <code>
        if main_board.isGoal() == True:
            main_board.print()
            print('You WIN!')
            break
                        </code>
                    </pre>
                </div>
                <p>最後まで残った場合には、まだ新しい盤面が見えていないので、しっかり盤面を見せてから while ループの先頭に戻してあげます。</p>
                <div class="real-code">
                    <pre>
                        <code>
        if main_board.isGoal() == True:
            main_board.print()
            print('You WIN!')
            break
        <span style="font-weight: bold;">main_board.print()</span>
                        </code>
                    </pre>
                </div>
            </section>
            <p class="snake-line">~~~~~~~~~~~~~~~</p>
            <section class="sub-section">
                <p>さあ、これでコーディングは全て終了しました。みなさま、長らくお疲れ様でした。</p>
                <div class="unagi">
                    <img src="../../unagi-pink800000/sweat.JPG" alt="">
                    <div class="balloon">
                        <p>疲れた...</p>
                    </div>
                </div>
                <p>ぜひご自分で遊んでみて、ご友人にも遊ばせてみて、今後のコーディングのモチベーションとしていただければと思います。</p>
                <p>この解説の中で矛盾や不明瞭な点、誤植などがございましたら、<a href="#footer">フッター</a>（ページ最下部）からご連絡ください。</p>
            </section>
        </section>

    </main>

    <footer id="footer">
        <ul>
            <li>LAST UPDATE: 2020/12/23</li>
            <li><a href="https://Saito-Saito-Saito.github.io" target="_blank">解説一覧</a></li>
            <li><a href="https://github.com/Saito-Saito-Saito" target="_blank">このページの作成者のGitHub</a></li>
            <li><a href="https://twitter.com/zsops_n" target="_blank">このページの作成者のTwitter</a></li>
            <li><a href="#">トップに戻る</a></li>
        </ul>
    </footer>
</body>
</html>