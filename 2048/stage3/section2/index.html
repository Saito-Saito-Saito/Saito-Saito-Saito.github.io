<html lang="ja">
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-166967736-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-166967736-1');
    </script>

    <title>Pythonプログラミングで2048を作る　3-2</title>
    
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta property="og:url" content="https://Saito-Saito-Saito.github.io/2048/stage3/section2">
    <meta property="og:title" content="Pythonプログラミングで2048を作る　3-2">
    <meta name="og:description" content="Pythonプログラミングによって、ターミナル上で実行できる2048を制作します。ここでは盤面を表すクラスコンストラクタを実装します。">
    <meta name="description" content="Pythonプログラミングによって、ターミナル上で実行できる2048を制作します。ここでは盤面を表すクラスコンストラクタを実装します。">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="twitter:card" content="summary_large_image"/>
    <meta property="og:image" content="https://Saito-Saito-Saito.github.io/unagi-study.JPG">

    <link rel="icon" href="https://Saito-Saito-Saito.github.io/icon.png">
    <link rel="stylesheet" href="../../stylesheet.css">
</head>
<body>
    <header>
        <div id="title">
            <h1>Pythonプログラミングで</h1>
            <h1>2048を作る</h1>
        </div>
    </header>

    <div id="menu-bar">
        <div id="short-menu">
            <input type="checkbox" id="acd-check">
            <table>
                <tr><td><a href="https://Saito-Saito-Saito.github.io/chess">HOME</a></td><td><label for="acd-check">STAGES</label></td><td><a href="https://Saito-Saito-Saito.github.io/2048/code">CODE</a></td>
                </tr>
            </table>
            <ul class="stages-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage1">Stage 1　プログラムの機能を考える</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage2">Stage 2　プログラムの土台を作る</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage3">Stage 3　盤面のクラスの基本機能を作る</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage4">Stage 4　盤面を動かす</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage5">Stage 5　ゲームの終了を判定する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage6">Stage 6　ゲーム進行を実装する</a></li>
            </ul>
        </div>
        <div id="long-menu">
            <table>
                <tr>
                    <td><a href="https://Saito-Saito-Saito.github.io/chess/">HOME</a></td>
                    <td><label for="acd-check1">Stage 1</label></td>
                    <td><label for="acd-check2">Stage 2</label></td>
                    <td><label for="acd-check3">Stage 3</label></td>
                    <td><label for="acd-check4">Stage 4</label></td>
                    <td><label for="acd-check5">Stage 5</label></td>
                    <td><label for="acd-check6">Stage 6</label></td>
                    <td><a href="https://Saito-Saito-Saito.github.io/2048/code">CODE</a></td>
                </tr>
            </table>
            <input type="checkbox" id="acd-check1" class="acd-check">
            <ul id="s1-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage1">Stage 1　プログラムの機能を考える</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage1/section1">1-1　盤面の機能を考える</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage1/section2">1-2　動きの機能を考える</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage1/section3">1-3　ゲーム進行の機能を考える</a></li>
            </ul>
            <input type="checkbox" id="acd-check2" class="acd-check">
            <ul id="s2-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage2">Stage 2　プログラムの土台を作る</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage2/section1">2-1　ロガーを設定する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage2/section2">2-2　定数を設定する</a></li>
            </ul>
            <input type="checkbox" id="acd-check3" class="acd-check">
            <ul id="s3-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage3">Stage 3　盤面のクラスの基本機能を作る</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage3/section1">3-1　新しい数を挿入する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage3/section2">3-2　コンストラクタを作る</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage3/section3">3-3　インデックスが適正か判断する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage3/section4">3-4　盤面を表示する</a></li>
            </ul>
            <input type="checkbox" id="acd-check4" class="acd-check">
            <ul id="s4-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage4">Stage 4　盤面を動かす</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage4/section1">4-1　概観を把握する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage4/section2">4-2　4 通りの場合わけをして盤面を動かす</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage4/section3">4-3　場合わけを統合したメソッドを実装する</a></li>
            </ul>
            <input type="checkbox" id="acd-check5" class="acd-check">
            <ul id="s5-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage5">Stage 5　ゲームの終了を判定する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage5/section1">5-1　ゲームクリアを判定する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage5/section2">5-2　手詰まりを判定する</a></li>
            </ul>
            <input type="checkbox" id="acd-check6" class="acd-check">
            <ul id="s6-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage6">Stage 6　ゲーム進行を実装する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage6/section1">6-1　ゴールやサイズの設定を変更する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage6/section2">6-2　スタートメニューを実装する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage6/section3">6-3　ゲーム進行を実装する</a></li>
            </ul>
        </div>
    </div>

    <main>
        <section id="s3-2">
            <h1>Stage 3　盤面のクラスの基本機能を作る</h1>
            <h2>3-2　コンストラクタ</h2>
            <section class="sub-section">
                <p>普通なら<a href="https://Saito-Saito-Saito.github.io/memorandom/Python/class#constructor_v" class="memo" target="_new">コンストラクタ</a>は<a href="https://Saito-Saito-Saito.github.io/memorandom/Python/class" class="memo" target="_new">クラス</a>の冒頭に持ってくるべきなんでしょうけれども、この 2048 では初期設定をする際に数字を 2 個ランダムに入れなければなりませんから、前回の <a href="../section1/index.html" target="_new">3-1</a> で先にその機能を insert <a href="https://Saito-Saito-Saito.github.io/memorandom/Python/class#method_v" class="memo" target="_new">メソッド</a>として実装したんでした。</p>
                <div class="unagi">
                    <img src="../../unagi-pink800000/normal.JPG" alt="">
                    <div class="balloon">
                        <p>でもコンストラクタはどうせ作るんやろ</p>
                    </div>
                </div>
                <p>ということで Board <a href="https://Saito-Saito-Saito.github.io/memorandom/Python/class" class="memo" target="_new">クラス</a>の<a href="https://Saito-Saito-Saito.github.io/memorandom/Python/class#constructor_v" class="memo" target="_new">コンストラクタ</a>を実装します。</p>
            </section>
            <p class="snake-line">~~~~~~~~~~~~~~~</p>
            <section class="sub-section">
                <p>まずはコードを見ていただきましょう。</p>
                <div class="real-code">
                    <pre>
                        <code>
    def __init__(self, *, size=DEFAULT_SIZE, board=[], goal=DEFAULT_GOAL, logger=local_logger, prob4=DEFAULT_PROB4):
        # copying the parameters
        self.size = size
        self.prob4 = prob4
        self.logger = logger
        if goal > MAX_GOAL:
            self.goal = MAX_GOAL
        else:
            self.goal = goal

        # copying the board
        if len(board) == self.size:
            self.board = copy.deepcopy(board)
        else:
            self.board = [[EMPTY for col in range(self.size)] for row in range(self.size)]
            self.insert(logger=logger)
            self.insert(logger=logger)
            
        logger.debug('in {}, board is {}'.format(self, self.board))

                        </code>
                    </pre>
                </div>
                <p><a href="../../stage1/section1/index.html" target="_new">1-1</a> でもわずかに触れましたが、各種パラメーターは変更が効く方がいいので、</p>
                <p>
                    <ul>
                        <li>盤面のサイズ</li>
                        <li>盤面</li>
                        <li>アガリの数</li>
                        <li>ロガー</li>
                        <li>4 が挿入される確率</li>
                    </ul>
                </p>
                <p>を引数に入れてしまいましょう。</p>
                <div class="real-code">
                    <pre>
                        <code>
    def __init__(self, *, size=DEFAULT_SIZE, board=[], goal=DEFAULT_GOAL, logger=local_logger, prob4=DEFAULT_PROB4):
                        </code>
                    </pre>
                </div>
                <p>全て<a href="https://Saito-Saito-Saito.github.io/memorandom/functions/#keyword" class="memo" target="_new">キーワード引数</a>にしてしまいました。基本的には <a href="../../stage2/section2/index.html" target="_new">2-2</a> で設定した定数をデフォルトに入れます。</p>
            </section>
            <p class="snake-line">~~~~~~~~~~~~~~~</p>
            <section class="sub-section">
                <p>中身に入りましょう。まずサイズと 4 が出る確率、<a href="https://Saito-Saito-Saito.github.io/memorandom/Python/logging/#logger_v" class="memo" target="_new">ロガー</a>は引数をそのまま使います。</p>
                <div class="real-code">
                    <pre>
                        <code>
    def __init__(self, *, size=DEFAULT_SIZE, board=[], goal=DEFAULT_GOAL, logger=local_logger, prob4=DEFAULT_PROB4):
        # copying the parameters
        <span style="font-weight: bold;">self.size = size
        self.prob4 = prob4
        self.logger = logger</span> 
        if goal > MAX_GOAL:
            self.goal = MAX_GOAL
        else:
            self.goal = goal
                        </code>
                    </pre>
                </div>
                <p>さて、ここで調節が必要になってくる引数がいくつかありますが、先にアガリの数に取り掛かりましょう。</p>
                <p><a href="../../stage2/section2/index.html" target="_new">2-2</a> で申し上げた通り、このあと扱う盤面表示のサイズの問題で使える数は、このコードでは最大で 5 桁です。なので取りうる値で一番大きい MAX_GOAL と比較して、これを上回るようなことがあれば無理やり MAX_GOAL にしてしまいます。それ以外は引数をそのまま使いましょう。</p>
                <div class="real-code">
                    <pre>
                        <code>
        if goal > MAX_GOAL:
            self.goal = MAX_GOAL
        else:
            self.goal = goal
                        </code>
                    </pre>
                </div>
            </section>
            <p class="snake-line">~~~~~~~~~~~~~~~</p>
            <section class="sub-section">
                <p>次に盤面を入力された場合の対処です。self.size ですでに盤面のサイズは指定しましたから、「もしサイズを満たすリストが board として入力されたら」という条件分岐で対処します。</p>
                <div class="real-code">
                    <pre>
                        <code>
        # copying the board
        if len(board) == self.size:
            self.board = copy.deepcopy(board)
        else:
            self.board = [[EMPTY for col in range(self.size)] for row in range(self.size)]
            self.insert(logger=logger)
            self.insert(logger=logger)
                        </code>
                    </pre>
                </div>
                <p>ここで、盤面を引数から受け継ぐときは必ず deepcopy <a href="https://Saito-Saito-Saito.github.io/memorandom/class#method_v" class="memo" target="_new">メソッド</a>を使いましょう。Python でリスト型は<a href="https://Saito-Saito-Saito.github.io/memorandom/list/#mutability" target="_new">ミュータブル</a>なので、これがないと<a href="https://Saito-Saito-Saito.github.io/memorandom/Python/class" class="memo" target="_new">クラス</a>内の変更が引数として入れただけのリストにまで及んでしまいます。</p>
                <div class="unagi">
                    <img src="../../unagi-pink800000/cheating.JPG" alt="">
                    <div class="balloon">
                        <p>なるほどね〜理解理解</p>
                    </div>
                </div>
                <p>わからなければリンクから備忘録をご覧になるなり、丁寧な解説を探すなりしてください。</p>
            </section>
            <p class="snake-line">~~~~~~~~~~~~~~~</p>
            <section class="sub-section">
                <p>board として有効なリストが入力されていない場合、つまり引数に盤面を入力しなかった場合は我々の方で盤面を新しく用意してあげる必要があります。盤面のサイズに合わせてまずは全てのマスを EMPTY で埋めつくし、</p>
                <div class="real-code">
                    <pre>
                        <code>
        else:
            <span style="font-weight: bold;">self.board = [[EMPTY for col in range(self.size)] for row in range(self.size)]</span> 
            self.insert(logger=logger)
            self.insert(logger=logger)
                        </code>
                    </pre>
                </div>
                <p>そのあと 2 回に分けて insert <a href="https://Saito-Saito-Saito.github.io/memorandom/class#method_v" class="memo" target="_new">メソッド</a>を使って数字を入力します。</p>
                <div class="real-code">
                    <pre>
                        <code>
        else:
            self.board = [[EMPTY for col in range(self.size)] for row in range(self.size)]
            <span style="font-weight: bold;">self.insert(logger=logger)
            self.insert(logger=logger)</span>
                        </code>
                    </pre>
                </div>
                <p>最後に<a href="https://Saito-Saito-Saito.github.io/memorandom/Python/logging/#logger_v" class="memo" target="_new">ロガー</a>を取ったら、これで<a href="https://Saito-Saito-Saito.github.io/memorandom/Python/class/#constructor_v" class="memo" target="_new">コンストラクタ</a>のコーディングは終了になります。</p>
            </section>
        </section>

        <section>
            <p><a href="../section3/index.html">NEXT　3-3　インデックスが適正か判定する</a></p>
        </section>
    </main>

    <footer>
        <ul>
            <li>LAST UPDATE: 2020/12/23</li>
            <li><a href="https://Saito-Saito-Saito.github.io" target="_blank">解説一覧</a></li>
            <li><a href="https://github.com/Saito-Saito-Saito" target="_blank">このページの作成者のGitHub</a></li>
            <li><a href="https://twitter.com/zsops_n" target="_blank">このページの作成者のTwitter</a></li>
            <li><a href="#">トップに戻る</a></li>
        </ul>
    </footer>
</body>
</html>