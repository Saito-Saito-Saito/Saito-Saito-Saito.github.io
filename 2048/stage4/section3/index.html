<html lang="ja">
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-166967736-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-166967736-1');
    </script>

    <title>Pythonプログラミングで2048を作る　4-3</title>
    
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta property="og:url" content="https://Saito-Saito-Saito.github.io/2048/stage4/section3">
    <meta property="og:title" content="Pythonプログラミングで2048を作る　4-3">
    <meta name="og:description" content="Pythonプログラミングによって、ターミナル上で実行できる2048を制作します。ここでは各方向に分割して考えた盤面を動かすアルゴリズムを統合します。">
    <meta name="description" content="Pythonプログラミングによって、ターミナル上で実行できる2048を制作します。ここでは各方向に分割して考えた盤面を動かすアルゴリズムを統合します。">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="twitter:card" content="summary"/>
    <meta property="og:image" content="https://Saito-Saito-Saito.github.io/2048/unagi-pink800000/normal.JPG">

    <link rel="icon" href="https://Saito-Saito-Saito.github.io/icon.png">
    <link rel="stylesheet" href="../../stylesheet.css">
</head>
<body>
    <header>
        <div id="title">
            <h1>Pythonプログラミングで</h1>
            <h1>2048を作る</h1>
        </div>
    </header>

    <div id="menu-bar">
        <div id="short-menu">
            <input type="checkbox" id="acd-check">
            <table>
                <tr><td><a href="https://Saito-Saito-Saito.github.io/chess">HOME</a></td><td><label for="acd-check">STAGES</label></td><td><a href="https://Saito-Saito-Saito.github.io/2048/code">CODE</a></td>
                </tr>
            </table>
            <ul class="stages-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage1">Stage 1　プログラムの機能を考える</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage2">Stage 2　プログラムの土台を作る</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage3">Stage 3　盤面のクラスの基本機能を作る</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage4">Stage 4　盤面を動かす</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage5">Stage 5　ゲームの終了を判定する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage6">Stage 6　ゲーム進行を実装する</a></li>
            </ul>
        </div>
        <div id="long-menu">
            <table>
                <tr>
                    <td><a href="https://Saito-Saito-Saito.github.io/chess/">HOME</a></td>
                    <td><label for="acd-check1">Stage 1</label></td>
                    <td><label for="acd-check2">Stage 2</label></td>
                    <td><label for="acd-check3">Stage 3</label></td>
                    <td><label for="acd-check4">Stage 4</label></td>
                    <td><label for="acd-check5">Stage 5</label></td>
                    <td><label for="acd-check6">Stage 6</label></td>
                    <td><a href="https://Saito-Saito-Saito.github.io/2048/code">CODE</a></td>
                </tr>
            </table>
            <input type="checkbox" id="acd-check1" class="acd-check">
            <ul id="s1-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage1">Stage 1　プログラムの機能を考える</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage1/section1">1-1　盤面の機能を考える</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage1/section2">1-2　動きの機能を考える</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage1/section3">1-3　ゲーム進行の機能を考える</a></li>
            </ul>
            <input type="checkbox" id="acd-check2" class="acd-check">
            <ul id="s2-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage2">Stage 2　プログラムの土台を作る</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage2/section1">2-1　ロガーを設定する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage2/section2">2-2　定数を設定する</a></li>
            </ul>
            <input type="checkbox" id="acd-check3" class="acd-check">
            <ul id="s3-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage3">Stage 3　盤面のクラスの基本機能を作る</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage3/section1">3-1　新しい数を挿入する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage3/section2">3-2　コンストラクタを作る</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage3/section3">3-3　インデックスが適正か判断する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage3/section4">3-4　盤面を表示する</a></li>
            </ul>
            <input type="checkbox" id="acd-check4" class="acd-check">
            <ul id="s4-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage4">Stage 4　盤面を動かす</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage4/section1">4-1　概観を把握する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage4/section2">4-2　4 通りの場合わけをして盤面を動かす</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage4/section3">4-3　場合わけを統合したメソッドを実装する</a></li>
            </ul>
            <input type="checkbox" id="acd-check5" class="acd-check">
            <ul id="s5-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage5">Stage 5　ゲームの終了を判定する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage5/section1">5-1　ゲームクリアを判定する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage5/section2">5-2　手詰まりを判定する</a></li>
            </ul>
            <input type="checkbox" id="acd-check6" class="acd-check">
            <ul id="s6-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage6">Stage 6　ゲーム進行を実装する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage6/section1">6-1　ゴールやサイズの設定を変更する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage6/section2">6-2　スタートメニューを実装する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/2048/stage6/section3">6-3　ゲーム進行を実装する</a></li>
            </ul>
        </div>
    </div>

    <main>
        <section id="s4-3">
            <h1>Stage 4　盤面を動かす</h1>
            <h2>4-3　場合わけを統合したメソッド</h2>
            <section class="sub-section">
                <p><a href="../section2/index.html" target="_new">4-2</a> では上下左右全ての方向について場合わけを行いました。結果、あまりにもコードに同じ箇所が出てきてしまいましたので、これを全て一括で表そうと思います。</p>
                <p>ここがこのプログラミング一番の難所です。抽象度が一気にバクあがりしますので、一つ一つ丁寧に読んでいってください。</p>
            </section>
            <p class="snake-line">~~~~~~~~~~~~~~~</p>
            <section class="sub-section">
                <p>それでは <a href="https://Saito-Saito-Saito.github.io/2048/code/#board" target="_new">board.py</a> ファイルの Board <a href="https://Saito-Saito-Saito.github.io/memorandom/Python/class" class="memo" target="_new">クラス</a> move <a href="https://Saito-Saito-Saito.github.io/memorandom/Python/class/#method_v" class="memo" target="_new">メソッド</a>をご用意ください。</p>
                <div class="real-code">
                    <pre>
                        <code>
    def move(self, direction: list, *, logger=None):
        logger = logger or self.logger
        ever_moved = False
        start = [0, self.size - 1]  # UP&LEFT: 0,  DOWN&RIGHT: size - 1
        step = [1, -1]  # UP&LEFT: 1,  DOWN&RIGHT: -1
        stop = [self.size, -1]  # UP&LEFT: size,  DOWN&RIGHT: -1
        switch = (direction in [DOWN, RIGHT])   # UP&LEFT: False,  DOWN&RIGHT: True
        
        # cf. move.py and https://Saito-Saito-Saito.github.io/2048/stage4
        root = [0, 0]
        for root[COL] in range(start[switch], stop[switch], step[switch]):
            for root[ROW] in range(start[switch], stop[switch], step[switch]):
                focused = [root[ROW] - direction[ROW], root[COL] - direction[COL]]
                while self.isInBoard(focused[ROW]) and self.isInBoard(focused[COL]):
                    # in case root == EMPTY
                    if self.board[root[ROW]][root[COL]] == EMPTY != self.board[focused[ROW]][focused[COL]]:
                        logger.info('{}, {} &lt;- {}'.format(root[ROW], root[COL], self.board[focused[ROW]][focused[COL]]))
                        self.board[root[ROW]][root[COL]] = self.board[focused[ROW]][focused[COL]]
                        self.board[focused[ROW]][focused[COL]] = EMPTY
                        ever_moved = True
                    # in case root == focused != EMPTY
                    elif self.board[root[ROW]][root[COL]] == self.board[focused[ROW]][focused[COL]] != EMPTY:
                        logger.info('{}, {} &lt;- {}'.format(root[ROW], root[COL], self.board[focused[ROW]][focused[COL]]))
                        self.board[root[ROW]][root[COL]] *= 2
                        self.board[focused[ROW]][focused[COL]] = EMPTY
                        ever_moved = True
                        break
                    # in case EMPTY != root != focuseed != EMPTY
                    elif self.board[focused[ROW]][focused[COL]] != EMPTY:
                        break
                    # either is zero
                    focused[ROW] -= direction[ROW]
                    focused[COL] -= direction[COL]

        if ever_moved == True:
            return SUCCEEDED
        else:
            # if no number was moved, it is game over
            logger.debug('ever_moved == False')
            return FAILED
                        </code>
                    </pre>
                </div>
                <div class="unagi">
                    <img src="../../unagi-pink800000/normal.JPG" alt="">
                    <div class="balloon">
                        <p>なげぇ...けどこれでもまとまった方か</p>
                    </div>
                </div>
                <p><a href="../section2/index.html" target="_new">4-2</a> のコードのほぼ 1/4 に短縮されています。</p>
            </section>
            <p class="snake-line">~~~~~~~~~~~~~~~</p>
            <section class="sub-section">
                <p>引数や<a href="https://Saito-Saito-Saito.github.io/memorandom/Python/logging/#logger_v" class="memo" target="_new">ロガー</a>、ever_moved の設定は <a href="../section2/index.html" target="_new">4-2</a> で行ったものと同じです。</p>
                <div class="real-code">
                    <pre>
                        <code>
    def move(self, direction: list, *, logger=None):
        logger = logger or self.logger
        ever_moved = False
                        </code>
                    </pre>
                </div>
                <p>さて、<a href="../section2/index.html" target="_new">4-2</a> で見ましたが、上下左右の 4 方向で異なるのは <a href="https://Saito-Saito-Saito.github.io/2048/memo/#root_v" class="memo" target="_new">root</a> と <a href="https://Saito-Saito-Saito.github.io/2048/memo/#focused_v" class="memo" target="_new">focused</a> の動きの違いだけです。それ以外は全てコピペでしたよね。ですから我々が本腰を入れて改良しなければいけないのは、for ループの変数設定部分と while ループの <a href="https://Saito-Saito-Saito.github.io/2048/memo/#focused_v" class="memo" target="_new">focused</a> を動かす部分です。</p>
                <p>各方向での動きはこうなります。</p>
                <table border="1" cellpadding="10" style="max-width: 600px; margin: 0 5%;border: solid black 1px; border-collapse: collapse;">
                    <tr><th>direction</th><th><a href="https://Saito-Saito-Saito.github.io/2048/memo/#root_v" class="memo" target="_new">root</a></th><th><a href="https://Saito-Saito-Saito.github.io/2048/memo/#focused_v" class="memo" target="_new">focused</a></th></tr>
                    <tr><td>UP</td><td><a href="https://Saito-Saito-Saito.github.io/2048/memo/#row_v" class="memo" target="_new">row</a> が増える方向</td><td><a href="https://Saito-Saito-Saito.github.io/2048/memo/#row_v" class="memo" target="_new">row</a> が増える方向</td></tr>
                    <tr><td>DOWN</td><td><a href="https://Saito-Saito-Saito.github.io/2048/memo/#row_v" class="memo" target="_new">row</a> が減る方向</td><td><a href="https://Saito-Saito-Saito.github.io/2048/memo/#row_v" class="memo" target="_new">row</a> が減る方向</td></tr>
                    <tr><td>LEFT</td><td><a href="https://Saito-Saito-Saito.github.io/2048/memo/#column_v" class="memo" target="_new">column</a> が増える方向</td><td><a href="https://Saito-Saito-Saito.github.io/2048/memo/#column_v" class="memo" target="_new">column</a> が増える方向</td></tr>
                    <tr><td>RIGHT</td><td><a href="https://Saito-Saito-Saito.github.io/2048/memo/#column_v" class="memo" target="_new">column</a> が減る方向</td><td><a href="https://Saito-Saito-Saito.github.io/2048/memo/#column_v" class="memo" target="_new">column</a> が減る方向</td></tr>
                </table>
                <p>UP と DOWN について <a href="https://Saito-Saito-Saito.github.io/2048/memo/#column_v" class="memo" target="_new">column</a> はどう動かしても問題ないですし、LEFT と RIGHT についても <a href="https://Saito-Saito-Saito.github.io/2048/memo/#row_v" class="memo" target="_new">row</a> はどのように動かしても構いません。</p>
                <p>そして <a href="https://Saito-Saito-Saito.github.io/2048/memo/#row_v" class="memo" target="_new">row</a> と <a href="https://Saito-Saito-Saito.github.io/2048/memo/#column_v" class="memo" target="_new">column</a> どちらの for ループを内側にしても大丈夫です。</p>
                <div class="unagi">
                    <img src="../../unagi-pink800000/normal.JPG" alt="">
                    <div class="balloon">
                        <p>ホントにぃ〜？</p>
                    </div>
                </div>
                <p>やってみましょうか。</p>
                <img src="pre-move.png" alt="UNAVAILABLE" width="90%" style="max-width: 300px;">
                <p>この盤面を左に動かしますよ。</p>
                <img src="left.gif" alt="UNAVAILABLE" width="90%" style="max-width: 300px;">
                <div class="unagi">
                    <img src="../../unagi-pink800000/normal.JPG" alt="">
                    <div class="balloon">
                        <p>確かに root の row と column の順番関係なさそやな</p>
                    </div>
                </div>
                <p>ということで、<a href="https://Saito-Saito-Saito.github.io/2048/memo/#root_v" class="memo" target="_new">root</a> を操る for 文は <a href="https://Saito-Saito-Saito.github.io/2048/memo/#row_v" class="memo" target="_new">row</a> と <a href="https://Saito-Saito-Saito.github.io/2048/memo/#column_v" class="memo" target="_new">column</a> どっちを内側にするかはテキトーに決めておきます。</p>
            </section>
            <p class="snake-line">~~~~~~~~~~~~~~~</p>
            <section class="sub-section">
                <p>さて、コードに入る前に <a href="https://Saito-Saito-Saito.github.io/2048/memo/#root_v" class="memo" target="_new">root</a> の <a href="https://Saito-Saito-Saito.github.io/2048/memo/#row_v" class="memo" target="_new">row</a> と <a href="https://Saito-Saito-Saito.github.io/2048/memo/#column_v" class="memo" target="_new">column</a> をどんな範囲に設定するか決めておかなくてはなりません。<a href="../section2/index.html" target="_new">4-2</a> では range の中身をこうしていました。</p>
                <table border="1" cellpadding="10" style="max-width: 600px; margin: 0 5%;border: solid black 1px; border-collapse: collapse;">
                    <tr><td>値が増える</td><td>値が減る</td></tr>
                    <tr><td>UP の <a href="https://Saito-Saito-Saito.github.io/2048/memo/#row_v" class="memo" target="_new">row</a><br>LEFT の <a href="https://Saito-Saito-Saito.github.io/2048/memo/#column_v" class="memo" target="_new">column</a></td><td>DOWN の <a href="https://Saito-Saito-Saito.github.io/2048/memo/#row_v" class="memo" target="_new">row</a><br>RIGHT の <a href="https://Saito-Saito-Saito.github.io/2048/memo/#column_v" class="memo" target="_new">column</a></td></tr>
                    <tr><td>range(self.size)</td><td>range(self.size - 1, -1, -1)</td></tr>
                </table>
                <p>さて、増える場合の <code>range(self.size)</code> って、要は <code>range(0, self.size, +1)</code> を略した形じゃないですか。そこで UP/LEFT と DOWN/RIGHT で range の中身をスイッチのように切り替える、そんな風にしたいと考えています。</p>
                <p>range(start, stop, step) という形なので、</p>
                <div class="real-code">
                    <pre>
                        <code>
        logger = logger or self.logger
        ever_moved = False
        <span style="font-weight: bold;">start = [0, self.size - 1]  # UP&LEFT: 0,  DOWN&RIGHT: size - 1
        step = [1, -1]  # UP&LEFT: 1,  DOWN&RIGHT: -1
        stop = [self.size, -1]  # UP&LEFT: size,  DOWN&RIGHT: -1</span>
        switch = (direction in [DOWN, RIGHT])   # UP&LEFT: False,  DOWN&RIGHT: True
                        </code>
                    </pre>
                </div>
                <p>としておいて、UP/LEFT なら前を、DOWN/RIGHT のときは後ろを使うようにします。</p>
                <p>そのスイッチの役割になっているのが名実ともに switch ですね。</p>
                <div class="real-code">
                    <pre>
                        <code>
        start = [0, self.size - 1]  # UP&LEFT: 0,  DOWN&RIGHT: size - 1
        step = [1, -1]  # UP&LEFT: 1,  DOWN&RIGHT: -1
        stop = [self.size, -1]  # UP&LEFT: size,  DOWN&RIGHT: -1
        <span style="font-weight: bold;">switch = (direction in [DOWN, RIGHT])   # UP&LEFT: False,  DOWN&RIGHT: True</span>
                        </code>
                    </pre>
                </div>
                <p>switch は bool 型ですが、bool 型は True が 1, False が 0 に対応しますので、switch をそのままリストの<a href="https://Saito-Saito-Saito.gothub.io/memorandom/Python/list/#index_v" class="memo" target="_new">インデックス</a>に入れてもらって大丈夫です。結局、</p>
                <p class="code"><code>for root[...] in range(start[switch], stop[switch], step[switch]):</code></p>
                <p>という使い方をします。実際にコードを見てみましょう。</p>
                <div class="real-code">
                    <pre>
                        <code>
        # cf. move.py and https://Saito-Saito-Saito.github.io/2048/stage4
        root = [0, 0]
        <span>for root[COL] in range(start[switch], stop[switch], step[switch]):
            for root[ROW] in range(start[switch], stop[switch], step[switch]):</span>
                focused = [root[ROW] - direction[ROW], root[COL] - direction[COL]]
                ...
                        </code>
                    </pre>
                </div>
                <p><code>root = [0, 0]</code> としているのはリストとして <a href="https://Saito-Saito-Saito.github.io/2048/memo/#root_v" class="memo" target="_new">root</a> を宣言するためでした。</p>
            </section>
            <p class="snake-line">~~~~~~~~~~~~~~~</p>
            <section class="sub-section">
                <p>さて、<a href="https://Saito-Saito-Saito.github.io/2048/memo/#focused_v" class="memo" target="_new">focused</a> を操りましょう。ただ、ここでは direction がそれぞれどんな値だったかしっかり思い出してもらわなければいけません。<a href="../../stage2/section2/index.html" target="_new">2-2</a> で定義した通り、</p>
                <table border="1" cellpadding="10" style="max-width: 600px; margin: 0 5%;border: solid black 1px; border-collapse: collapse;">
                    <tr><th>direction</th><th>value</th></tr>
                    <tr><td>UP</td><td><code>[-1, 0]</code></td></tr>
                    <tr><td>DOWN</td><td><code>[+1, 0]</code></td></tr>
                    <tr><td>LEFT</td><td><code>[0, -1]</code></td></tr>
                    <tr><td>RIGHT</td><td><code>[0, +1]</code></td></tr>
                </table>
                <p>ですね。これを使ってまずは <a href="https://Saito-Saito-Saito.github.io/2048/memo/#focused_v" class="memo" target="_new">focused</a> の位置取りをします。</p>
                <p>具体的な事例で考えてみましょう。direction == UP のときは <a href="https://Saito-Saito-Saito.github.io/2048/memo/#focused_v" class="memo" target="_new">focused</a> は <a href="https://Saito-Saito-Saito.github.io/2048/memo/#root_v" class="memo" target="_new">root</a> のすぐ</p>
                <p class="stress">下</p>
                <p>でしたよね。<a href="https://Saito-Saito-Saito.github.io/2048/memo/#row_v" class="memo" target="_new">row</a> を下げるときは <a href="https://Saito-Saito-Saito.github.io/2048/memo/#row_v" class="memo" target="_new">row</a> の値に 1 を加えるんでした。DOWN のときは <a href="https://Saito-Saito-Saito.github.io/2048/memo/#root_v" class="memo" target="_new">root</a> のすぐ上で 1 を引く、LEFT なら <a href="https://Saito-Saito-Saito.github.io/2048/memo/#root_v" class="memo" target="_new">root</a> の右で <a href="https://Saito-Saito-Saito.github.io/2048/memo/#column_v" class="memo" target="_new">column</a> に 1 を足す、RIGHT なら <a href="https://Saito-Saito-Saito.github.io/2048/memo/#root_v" class="memo" target="_new">root</a> の左で 1 を引く。</p>
                <p>つまり <a href="https://Saito-Saito-Saito.github.io/2048/memo/#focused_v" class="memo" target="_new">focused</a> は <a href="https://Saito-Saito-Saito.github.io/2048/memo/#root_v" class="memo" target="_new">root</a> からみて direction とは反対むきに 1 マス進んだところにあるんです。direcrion の向きに進みたいときは <code>[row + direction[ROW], col + direction[COL]]</code> としましたから、逆向きに進むときは <code>[row - direction[ROW], col - direction[COL]]</code> ですね。</p>
                <div class="real-code">
                    <pre>
                        <code>
        for root[COL] in range(start[switch], stop[switch], step[switch]):
            for root[ROW] in range(start[switch], stop[switch], step[switch]):
                <span style="font-weight: bold;">focused = [root[ROW] - direction[ROW], root[COL] - direction[COL]]</span>
                while self.isInBoard(focused[ROW]) and self.isInBoard(focused[COL]):
                        </code>
                    </pre>
                </div>
                <p>while では isInBoard を <a href="https://Saito-Saito-Saito.github.io/2048/memo/#row_v" class="memo" target="_new">row</a> にも <a href="https://Saito-Saito-Saito.github.io/2048/memo/#column_v" class="memo" target="_new">column</a> にも使って <a href="https://Saito-Saito-Saito.github.io/2048/memo/#focused_v" class="memo" target="_new">focused</a> が盤面の外に出ていないか検証します。かたっぽでも出てたらループを抜けないとですよ。</p>
            </section>
            <p class="snake-line">~~~~~~~~~~~~~~~</p>
            <section class="sub-section">
                <p>ここから先の if による条件分岐は 5-2 と全く変わりません。全てコピペで結構です。</p>
                <div class="real-code">
                    <pre>
                        <code>
                    # in case root == EMPTY
                    if self.board[root[ROW]][root[COL]] == EMPTY != self.board[focused[ROW]][focused[COL]]:
                        logger.info('{}, {} &lt;- {}'.format(root[ROW], root[COL], self.board[focused[ROW]][focused[COL]]))
                        self.board[root[ROW]][root[COL]] = self.board[focused[ROW]][focused[COL]]
                        self.board[focused[ROW]][focused[COL]] = EMPTY
                        ever_moved = True
                    # in case root == focused != EMPTY
                    elif self.board[root[ROW]][root[COL]] == self.board[focused[ROW]][focused[COL]] != EMPTY:
                        logger.info('{}, {} &lt;- {}'.format(root[ROW], root[COL], self.board[focused[ROW]][focused[COL]]))
                        self.board[root[ROW]][root[COL]] *= 2
                        self.board[focused[ROW]][focused[COL]] = EMPTY
                        ever_moved = True
                        break
                    # in case EMPTY != root != focuseed != EMPTY
                    elif self.board[focused[ROW]][focused[COL]] != EMPTY:
                        break
                        </code>
                    </pre>
                </div>
                <p>最後に <a href="https://Saito-Saito-Saito.github.io/2048/memo/#focused_v" class="memo" target="_new">focused</a> を動かします。これも UP の場合は <a href="https://Saito-Saito-Saito.github.io/2048/memo/#root_v" class="memo" target="_new">root</a> を下に、DOWN の場合は <a href="https://Saito-Saito-Saito.github.io/2048/memo/#root_v" class="memo" target="_new">root</a> を上に ... とするわけですから、direction とは逆向きに進めなければいけませんよね。したがって focused[ROW], focused[COL] それぞれから direction[ROW], direction[COL] を</p>
                <p class="stress">引きます。</p>
                <div class="real-code">
                    <pre>
                        <code>
                    # either is zero
                    focused[ROW] -= direction[ROW]
                    focused[COL] -= direction[COL]
                        </code>
                    </pre>
                </div>
                <p>大丈夫ですよね？さっきと同じ仕組みですよ。わからなくなったら必ず戻って確認すること。</p>
                <div class="unagi">
                    <img src="../../unagi-pink800000/normal.JPG" alt="">
                    <div class="balloon">
                        <p>row と column 両方変化させんの？</p>
                    </div>
                </div>
                <p>UP/DOWN/LEFT/RIGHT いずれにしても direction[ROW] と direction[COL] のどちらかは 0 ですから、片方しか変化しません。</p>
            </section>
            <p class="snake-line">~~~~~~~~~~~~~~~</p>
            <section class="sub-section">
                <p>最後に、リターンするものは 5-2 と全く同じです。ever_moved が True つまり数字が一つでも動いていれば「成功」SUCCEEDED を、そうでなければ「失敗」FAILED をリターンです。</p>
                <div class="real-code">
                    <pre>
                        <code>
        if ever_moved == True:
            return SUCCEEDED
        else:
            # if no number was moved, it is game over
            logger.debug('ever_moved == False')
            return FAILED
                        </code>
                    </pre>
                </div>
                <p>失敗したときは<a href="https://Saito-Saito-Saito.github.io/memorandom/Python/logging" class="memo" target="_new">ログ</a>でその理由を教えてあげるのがいいでしょう。</p>
            </section>
        </section>

        <section>
            <p><a href="../../stage5/index.html">NEXT　Stage 5　ゲームの終了を判定する</a></p>
        </section>
    </main>

    <footer>
        <ul>
            <li>LAST UPDATE: 2020/09/25</li>
            <li><a href="https://Saito-Saito-Saito.github.io" target="_blank">解説一覧</a></li>
            <li><a href="https://github.com/Saito-Saito-Saito" target="_blank">このページの作成者のGitHub</a></li>
            <li><a href="https://twitter.com/zsops_n" target="_blank">このページの作成者のTwitter</a></li>
            <li><a href="#">トップに戻る</a></li>
        </ul>
    </footer>
</body>
</html>