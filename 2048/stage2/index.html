<html lang="ja">
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-166967736-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-166967736-1');
    </script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>これであなたも2048が作れる 2</title>
    <link rel="stylesheet" href="../stylesheet.css">
</head>
<body>
    <header>
        <div id="title">
            <h1>これであなたも</h1>
            <h1>2048が作れる</h1>
        </div>
        <ul>
            <li><a href="https://Saito-Saito-Saito.github.io/2048">Stage 0&1</a></li>
            <li><a href="#">Stage 2</a></li>
            <li><a href="https://Saito-Saito-Saito.github.io/2048/stage3">Stage 3</a></li>
            <li><a href="https://Saito-Saito-Saito.github.io/2048/stage4">Stage 4</a></li>
            <li><a href="https://Saito-Saito-Saito.github.io/2048/stage5">Stage 5</a></li>
            <li><a href="https://Saito-Saito-Saito.github.io/2048/stage6">Stage 6</a></li>
            <li><a href="https://Saito-Saito-Saito.github.io/2048/stage7">Stage 7</a></li>
            <li><a href="https://github.io/Saito-Saito-Saito/2048" target="_blank">Code</a></li>
        </ul>
    </header>

    <div class="acd-menu">
        <input type="checkbox" id="acd-check">
        <label for="acd-check" class="acd-label">MENU</label>
        <ul class="acd-content">
            <li><a href="https://Saito-Saito-Saito.github.io/2048">Stage 0&1</a></li>
            <li><a href="#">Stage 2</a></li>
            <li><a href="https://Saito-Saito-Saito.github.io/2048/stage3">Stage 3</a></li>
            <li><a href="https://Saito-Saito-Saito.github.io/2048/stage4">Stage 4</a></li>
            <li><a href="https://Saito-Saito-Saito.github.io/2048/stage5">Stage 5</a></li>
            <li><a href="https://Saito-Saito-Saito.github.io/2048/stage6">Stage 6</a></li>
            <li><a href="https://Saito-Saito-Saito.github.io/2048/stage7">Stage 7</a></li>
            <li><a href="https://github.io/Saito-Saito-Saito/2048" target="_blank">Code</a></li>
        </ul>
    </div>

    <main>
        <section id="s2">
            <h1>Stage 2　プログラムの機能を考える</h1>
            <p>みなさま、ようこそ。2048 のプログラミング第 2 ステージです。プログラムをコーディングする前にある程度の大枠を決めてしまいましょう。この作業がないと全体の統率が図れませんよ。第一、どこに向かっているのかわからないのに全く見知らぬ土地を歩くのって怖いだけじゃなくてめんどくさいでしょ？</p>
        </section>

        <section class="index">
            <h2>目次</h2>
            <p>
                <ul>
                    <li><a href="#s2-1">2-1　盤面</a></li>
                    <li><a href="#s2-2">2-2　操作</a></li>
                    <li><a href="#s2-3">2-3　進行</a></li>
                </ul>
            </p>
        </section>

        <section id="s2-1">
            <h2>2-1　盤面</h2>
            <p>ノーマルの 2048 の盤面は 4 マス × 4 マスの正方形ですよね。ここはボードゲームのプログラミングの定石通りに多重配列でいきましょう。ここでいきなり 4 × 4 のリストを作るのではなく、あとでサイズ変更ができるように十難に設計しておくのがミソですね。8 × 8 とか、できないことはありませんから。</p>
            <p>ということで盤面は</p>
            <p class="code"><code>board = [row][col]</code></p>
            <p>という形にします。ここで row は横長の行(row)、col は縦長の列(collumn)を表します。なぜこの順番にするかというと、強い意味はありませんが、盤面を表示するとき(Stage 4)に順当にできるという意味がないわけではない。</p>
            <p>盤面の上に乗る数字はそのまま <code>board[row][col]</code> の値にしてしまいましょう。「数字がないところはどうすんの？」って、そりゃ 0 がいいんじゃないですか？まあ、ゲームを進めていくうちに絶対に出てくることがないような数字であればなんだっていいですよ。</p>
        </section>

        <section id="s2-2">
            <h2>2-2　操作</h2>
            <p>2048 のプログラミングで一番面倒な、盤面の操作について考えましょう。動かせる向きは上下左右の 4 方向、その方向に動くことで同じ数が足し合わされていきます。これをどうやって表現しましょうかね。</p>
            <section class="sub-section">
                <p>とりあえず盤面を上に動かす場合を例にとってみましょう。こういう場合はどうでしょうか。</p>
                <img src="pre-move.png" alt="UNAVAILABLE" width="90%" style="max-width: 300px;">
                <p>全く難しい問題ではありませんが、これを機械にやらせるということを念頭に置いて、そのアルゴリズムを予想してみてください。答えはこんなんですよね。まさか間違えるわけないとは思いますが。</p>
                <img src="pro-move.png" alt="UNAVAILABLE" width="90%" style="max-width: 300px;">
            </section>
            <section class="sub-section">
                <p>さて、これをどうやってプログラミングしましょうか。とりあえず一番左上 [0, 0] から始めるとして、まずはその直下のマス [1, 0] に注目します。この 2 マスの関係は</p>
                <p>
                    <ul>
                        <li><code>[0, 0] == EMPTY and [1, 0] == EMPTY</code></li>
                        <li><code>[0, 0] == EMPTY and [1, 0] != EMPTY</code></li>
                        <li><code>[0, 0] != EMPTY and [1, 0] == EMPTY</code></li>
                        <li><code>[0, 0] != EMPTY and [1, 0] == EMPTY</code></li>
                    </ul>
                </p>
                <p>の 4 つですね。まず一番上、両方とも EMPTY であれば何もすることはありません。その次の [1, 0] だけが EMPTY の場合、数字を [0, 0] に持ってこなければなりません。[1, 0] は数字がなくなるわけですから、当然 EMPTY にします。三番目、[0, 0] だけが EMPTY でない場合も何もする必要はありません。問題は 4 番目です。こいつには</p>
                <p>
                    <ul>
                        <li><code>0 != [0, 0] == [0, 1] != 0</code></li>
                        <li><code>0 != [0, 0] != [0, 0] != 0</code></li>
                    </ul>
                </p>
                <p>の 2 通りあり、対処も異なってきます。両方の数が揃う場合は単純で、[0, 0] にある数を 2 倍、[1, 0] を EMPTY にすれば事足ります。一方で両方の数字が揃わない場合、この段階で特にやることはありませんが、こういう場合はどうでしょうか。</p>
                <img src="up-exception.png" alt="UNAVAILABLE" width="90%" style="max-width: 300px;">
                <p>この次に [2, 0] と [0, 0] を比較して数字を移すか考えるわけですが、当然この二つの間で数のやりとりはできません。もっと言えば、もし [3, 0] に 2 があっても [0, 0] とは数のやりとりはできませんから、[0, 0] について考える必要はもうないことになります。</p>
            </section>
            <p>ここまでのフローを示すとこうなりますね。</p>
            <img src="flow-00-10.png" alt="UNAVAILABLE" width="90%" style="max-width: 300px;">
            <p>これ以上は Stage 5 で扱うことになりますが、一応大筋として頭の中に入れておいてください。</p>
        </section>

        <section id="s2-3">
            <h2>2-3　進行</h2>
            <p>ゲーム進行を考えましょう。2-1 でせっかくマスのサイズを拡張できるようにしたんですから、サイズとアガリになる数の設定くらいはできるようにしておきましょうか。そして最初の盤面を表示する。ここまでが初期設定です。</p>
            <p>実際にゲームに入った後のでアインに移ります。当然ながら上下左右の方向を指定できるようにしてあげなければなりませんが、残念ながら我々はまだ上下左右キーなどの高等な技術を使うことはできません。そこで数字を使ってコマンド風に操縦する方策と、ゲームなんかで左手用に使う W/S/D/A のキーに対応できるようにしましょう。それぞれ上・下・右・左に対応します。入力を受け取ったら方向に変換、もし正当な入力でなければ「もう一度やり直せ」と突き返すことになります。また、その方向に動かすことができない場合でも、もう一度やり直してもらいます。うまくいったら移動後の盤面を表示して繰り返しです。</p>
            <p>ゲームが終了するのは</p>
            <p>
                <ul>
                    <li>アガリの数がでてきたとき</li>
                    <li>これ以上盤面を動かせなくなったとき</li>
                </ul>
            </p>
            <p>の 2 パターンありますね。両方ともループを脱出して結果を教えてあげましょう。</p>
        </section>

        <section>
            <h2>次回予告</h2>
            <p>次回からはマジでコード本文の説明になります。まだ私のコードを用意されていない方は、<a href="https://github.com/Saito-Saito-Saito/2048" target="_blank">こちら</a>のページからコードを手に入れてください。</p>
            <img src="github-front.png" alt="UNAVAILABLE" width="90%" style="max-width: 600px;">
            <p>パソコンの方はこんなページがでてきて、右上の方に緑色で Clone or download って書いてるところをクリックすると、コードをダウンロードすることができます。</p>
            <p>スマホの方は、かなり見づらいのですが github のページ上で私のコードを開いていただくほかに賢明な方法がないかもしれません。嫌ならパソコンで見てくれ。</p>
            <p><a href="https://Saito-Saito-Saito.github.io/2048/stage3">次回　Stage 3　定数設定と新しい数の挿入</a></p>
        </section>
    </main>

    <footer>
        <ul>
            <li>LAST EDITED: 2020/6/28</li>
            <li><a href="https://saito-saito-saito.github.io" target="_blank">解説一覧</a></li>
            <li><a href="https://github.com/Saito-Saito-Saito" target="_blank">このページの作成者のGitHub</a></li>
            <li><a href="https://twitter.com/zsops_n" target="_blank">このページの作成者のTwitter</a></li>
            <li><a href="#">トップに戻る</a></li>
        </ul>
    </footer>
</body>
</html>