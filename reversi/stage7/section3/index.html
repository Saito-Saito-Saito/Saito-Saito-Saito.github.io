<html lang="ja">
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-166967736-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-166967736-1');
    </script>
    
    <title>Pythonプログラミングでリバーシを作る 7-3</title>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta property="og:url" content="https://Saito-Saito-Saito.github.io/chess/stage7/section3">
    <meta property="og:title" content="Pythonプログラミングでリバーシを作る 7-3">
    <meta property="og:description" content="Pythonプログラミングによって、ターミナル上で実行できるリバーシのゲームで、ユーザーの入力をマス目の情報に変換する機能を実装していきます。">
    <meta name="description" content="Pythonプログラミングによって、ターミナル上で実行できるリバーシのゲームで、ユーザーの入力をマス目の情報に変換する機能を実装していきます。">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="twitter:card" content="summary_large_image">
    <meta property="og:image" content="https://Saito-Saito-Saito.github.io/unagi-study.JPG">
    <meta name="google-site-verification" content="d3cz5KLnsS_25m1Shebvuyb3C4FfyoFNlPXdQ3z_oXg" />

    <link rel="icon" href="https://Saito-Saito-Saito.github.io/icon.png">
    <link rel="stylesheet" href="https://Saito-Saito-Saito.github.io/reversi/stylesheet.css">
</head>
<body>
    <header>
        <img src="https://Saito-Saito-Saito.github.io/unagi-top.png" alt="" width="90px">
        <div id="title">
            <h1>Pythonプログラミングで</h1>
            <h1>リバーシを作る</h1>
        </div>
    </header>

    <div id="menu-bar">
        <div id="short-menu">
                    <input type="checkbox" id="acd-check">
                    <table>
                        <tr><td><a href="https://Saito-Saito-Saito.github.io/reversi">HOME</a></td><td><label for="acd-check">STAGES</label></td><td><a href="https://Saito-Saito-Saito.github.io/reversi/code">CODE</a></td></tr>
                    </table>
                    <ul class="stages-menu">
                        <li><a href="https://Saito-Saito-Saito.github.io/reversi/stage1/">Stage 1　プログラムの機能を考える</a></li>
                        <li><a href="https://Saito-Saito-Saito.github.io/reversi/stage2/">Stage 2　プログラムの土台を作る</a></li>
                        <li><a href="https://Saito-Saito-Saito.github.io/reversi/stage3/">Stage 3　盤面を表すクラスの基本機能を作る</a></li>
                        <li><a href="https://Saito-Saito-Saito.github.io/reversi/stage4/">Stage 4　石をおけるか判別する機能を実装する</a></li>
                        <li><a href="https://Saito-Saito-Saito.github.io/reversi/stage5/">Stage 5　石を裏返す機能を実装する</a></li>
                        <li><a href="https://Saito-Saito-Saito.github.io/reversi/stage6/">Stage 6　パスと勝敗を判定する</a></li>
                        <li><a href="https://Saito-Saito-Saito.github.io/reversi/stage7/">Stage 7　ゲーム進行をデザインする</a></li>
                    </ul>
        </div>
        <div id="long-menu">
            <table>
                    <tr>
                            <td><a href="https://Saito-Saito-Saito.github.io/reversi/">HOME</a></td>
                            <td><label for="acd-check1">Stage 1</label></td>
                            <td><label for="acd-check2">Stage 2</label></td>
                            <td><label for="acd-check3">Stage 3</label></td>
                            <td><label for="acd-check4">Stage 4</label></td>
                            <td><label for="acd-check5">Stage 5</label></td>
                            <td><label for="acd-check6">Stage 6</label></td>
                            <td><label for="acd-check7">Stage 7</label></td>
                            <td><a href="https://Saito-Saito-Saito.github.io/reversi/code">CODE</a></td>
                    </tr>
            </table>
            <input type="checkbox" id="acd-check1" class="acd-check">
            <ul id="s1-menu" class="sections-menu">
                    <li><span><a href="https://Saito-Saito-Saito.github.io/reversi/stage1/">Stage 1　プログラムの機能を考える</a></span></li>
                    <li><a href="https://Saito-Saito-Saito.github.io/reversi/stage1/section1/">1-1　盤面の機能を考える</a></li>
                    <li><a href="https://Saito-Saito-Saito.github.io/reversi/stage1/section2/">1-2　石の操作を考える</a></li>
                    <li><a href="https://Saito-Saito-Saito.github.io/reversi/stage1/section3/">1-3　ゲーム進行を考える</a></li>
            </ul>
            <input type="checkbox" id="acd-check2" class="acd-check">
            <ul id="s2-menu" class="sections-menu">
                    <li><span><a href="https://Saito-Saito-Saito.github.io/reversi/stage2/">Stage 2　プログラムの土台を作る</a></span></li>
                    <li><a href="https://Saito-Saito-Saito.github.io/reversi/stage2/section1/">2-1　ロガーの設定をする</a></li>
                    <li><a href="https://Saito-Saito-Saito.github.io/reversi/stage2/section2/">2-2　基本的な定数を宣言する</a></li>
            </ul>
            <input type="checkbox" id="acd-check3" class="acd-check">
            <ul id="s3-menu" class="sections-menu">
                    <li><span><a href="https://Saito-Saito-Saito.github.io/reversi/stage3/">Stage 3　盤面を表すクラスの基本機能を作る</a></span></li> 
                    <li><a href="https://Saito-Saito-Saito.github.io/reversi/stage3/section1/">3-1　コンストラクタを実装する</a></li>
                    <li><a href="https://Saito-Saito-Saito.github.io/reversi/stage3/section2/">3-2　盤面を表示する機能を実装する</a></li>
            </ul>
            <input type="checkbox" id="acd-check4" class="acd-check">
            <ul id="s4-menu" class="sections-menu">
                    <li><span><a href="https://Saito-Saito-Saito.github.io/reversi/stage4/">Stage 4　石をおけるか判別する機能を実装する</a></span></li>
                    <li><a href="https://Saito-Saito-Saito.github.io/reversi/stage4/section1/">4-1　石をおけるか判別する機能をデザインする</a></li>
                    <li><a href="https://Saito-Saito-Saito.github.io/reversi/stage4/section2/">4-2　石をおけるか判別する機能を実装する</a></li>
            </ul>
            <input type="checkbox" id="acd-check5" class="acd-check">
            <ul id="s5-menu" class="sections-menu">
                    <li><span><a href="https://Saito-Saito-Saito.github.io/reversi/stage5/">Stage 5　石を裏返す機能を実装する</a></span></li>
                    <li><a href="https://Saito-Saito-Saito.github.io/reversi/stage5/section1/">5-1　石を裏返す機能をデザインする</a></li>
                    <li><a href="https://Saito-Saito-Saito.github.io/reversi/stage5/section2/">5-2　石を裏返す機能を実装する</a></li>
            </ul>
            <input type="checkbox" id="acd-check6" class="acd-check">
            <ul id="s6-menu" class="sections-menu">
                    <li><span><a href="https://Saito-Saito-Saito.github.io/reversi/stage6/">Stage 6　パスと勝敗を判定する</a></span></h3>
                    <li><a href="https://Saito-Saito-Saito.github.io/reversi/stage6/section1/">6-1　パスを判定する機能を実装する</a></p>
                    <li><a href="https://Saito-Saito-Saito.github.io/reversi/stage6/section2/">6-2　勝敗を判定する機能を実装する</a></p>
            </ul>
            <input type="checkbox" id="acd-check7" class="acd-check">
            <ul id="s7-menu" class="sections-menu">
                    <li><span><a href="https://Saito-Saito-Saito.github.io/reversi/stage7/">Stage 7　ゲーム進行をデザインする</a></span></h3>
                    <li><a href="https://Saito-Saito-Saito.github.io/reversi/stage7/section1/">7-1　初期設定する機能を実装する</a></p>
                    <li><a href="https://Saito-Saito-Saito.github.io/reversi/stage7/section2/">7-2　各種判定機能を運用する</a></p>
                    <li><a href="https://Saito-Saito-Saito.github.io/reversi/stage7/section3/">7-3　入力文字列をマス目の情報に変換する</a></p>
                    <li><a href="https://Saito-Saito-Saito.github.io/reversi/stage7/section4/">7-4　入力処理を実装する</a></p>
                    <li><a href="https://Saito-Saito-Saito.github.io/reversi/stage7/section5/">7-5　ゲームセット後の操作を実装する</a></p>
            </ul>
        </div>
    </div>

    <main>
        <section id="s4">
            <h1>Stage 7　ゲーム進行をデザインする</h1>
            <h2>7-3　入力文字列をマス目の情報に変換する</h2>
            <section class="sub-section">
                <p>今回は一度 <a href="https://Saito-Saito-Saito.github.io/reversi/code/#IO" target="_new">IO.py</a> に飛んで、ユーザーが入力する文字列をマス目の情報に変換する機能を実装していきます。</p>
                <div class="real-code">
                    <pre>
                        <code>
#! /usr/bin/env python3
# IO.py
# programmed by Saito-Saito-Saito
# explained in https://Saito-Saito-Saito.github.io/reversi
# last update: 2/7/2020


import config
local_logger = config.setLogger(__name__)



# translate user's input into the index of the square
def InputFormat(s):
    if len(s) != 2:
        local_logger.info('len(s) == {}'.format(len(s)))
        return config.FAILED
    elif s[0].isdecimal() and config.InBoard(int(s[0]) - 1) and ord('a') <= ord(s[1]) <= ord('h'):
        return [int(s[0]) - 1, ord(s[1]) - ord('a')]
    elif s[1].isdecimal() and config.InBoard(int(s[1]) - 1) and ord('a') <= ord(s[0]) <= ord('h'):
        return [int(s[1]) - 1, ord(s[0]) - ord('a')]
    else:
        local_logger.info('OUT OF FORMAT')
        return config.FAILED
                        </code>
                    </pre>
                </div>
                <p>実際にコーディングするのは、基本的には InputFormat 関数だけです。実際にみていきましょう。</p>
            </section>
            <p class="snake-line">~~~~~~~~~~~~~~~</p>
            <section class="sub-section">
                <p>まずは config をインポートして<a href="https://Saito-Saito-Saito.github.io/memorandom/Python/logging/#logger_v" class="memo" target="_new">ロガー</a>を設定します。</p>
                <div class="real-code">
                    <pre>
                        <code>
import config
local_logger = config.setLogger(__name__)
                        </code>
                    </pre>
                </div>
                <p>そしたら関数の中に入ります。引数はユーザーが入力した文字列 s をそのまま使います。</p>
                <div class="real-code">
                    <pre>
                        <code>
# translate user's input into the index of the square
<span style="font-weight: bold;">def InputFormat(s):</span>
                        </code>
                    </pre>
                </div>
                <p>このあと s から必要な情報を取り出すのですが、もうみなさん忘れている頃だと思いますので、このゲームでどうやって文字列でマス目を特定するかおさらいしましょう。</p>
                <img src="board.png" alt="UNAVAILABLE" width="90%" style="max-width: 300px;">
                <p>マス目を指定するときに使うのは</p>
                <p>
                    <ul>
                        <li>a ~ h の <a href="https://Saito-Saito-Saito.github.io/reversi/memo/#column_v" class="memo" target="_new">column</a> を表すアルファベット</li>
                        <li>1 ~ 8 の <a href="https://Saito-Saito-Saito.github.io/reversi/memo/#row_v" class="memo" target="_new">row</a> を表す数字</li>
                    </ul>
                </p>
                <p>でした。例えば右上角のマスを指定する際は h1, 初期状態で白の石が置かれている右下のマスは e5 といった具合に。</p>
                <p>したがって、そもそも文字列の長さが 2 でないようであれば検討する必要などないと言うことになります。</p>
                <div class="real-code">
                    <pre>
                        <code>
    if len(s) != 2:
        local_logger.info('len(s) == {}'.format(len(s)))
        return config.FAILED
                        </code>
                    </pre>
                </div>
                <p>文字列の長さがあっていれば、あとは１文字目と２文字目がそれぞれ正しい情報を与えているか検討すればいいですね。</p>
            </section>
            <p class="snake-line">~~~~~~~~~~~~~~~</p>
            <section class="sub-section">
                <p>ところで、上の例では h1, e5 のように「<a href="https://Saito-Saito-Saito.github.io/reversi/memo/#column_v" class="memo" target="_new">column</a> を表すアルファベット → <a href="https://Saito-Saito-Saito.github.io/reversi/memo/#row_v" class="memo" target="_new">row</a> を表す数字」の順番で書きましたが、これ逆でも良くないですか？</p>
                <div class="unagi">
                    <img src="https://Saito-Saito-Saito.github.io/reversi/unagi-yellow696969/normal.JPG" alt="">
                    <div class="balloon">
                        <p>1h, 5e って書くってことやろ</p>
                    </div>
                </div>
                <p>そうです。それでも別にマス目を特定するには困りませんよね？</p>
                <p>ということで、数字を先に書いてもアルファベットを先に書いてもいいようにします。それをしているのが次の条件分岐ですね。</p>
                <div class="real-code">
                    <pre>
                        <code>
    elif s[0].isdecimal() and config.InBoard(int(s[0]) - 1) and ord('a') &lt;= ord(s[1]) &lt;= ord('h'):
        return [int(s[0]) - 1, ord(s[1]) - ord('a')]
    elif s[1].isdecimal() and config.InBoard(int(s[1]) - 1) and ord('a') &lt;= ord(s[0]) &lt;= ord('h'):
        return [int(s[1]) - 1, ord(s[0]) - ord('a')]
                        </code>
                    </pre>
                </div>
                <p><a href="https://Saito-Saito-Saito.github.io/memorandom/Python/str/#isdecimal" class="memo" target="_new">isdecimal メソッド</a>は文字が数字であるかどうかを判断します。上の elif では１文字目が、下側の elif では２文字目が数字かどうかを判断します。</p>
                <p>とりあえず１文字目が数字の場合を見てみましょう。この時、１文字目の数字がちゃんと盤面の <a href="https://Saito-Saito-Saito.github.io/reversi/memo/#column_v" class="memo" target="_new">column</a> の範囲に入っている必要がありますから、InBoard <a href="https://Saito-Saito-Saito.github.io/memorandom/Python/class/#method_v" class="memo" target="_new">メソッド</a>を使って判定しましょう。</p>
                <div class="real-code">
                    <pre>
                        <code>
    elif s[0].isdecimal() and <span style="font-weight: bold;">config.InBoard(int(s[0]) - 1)</span> and ord('a') &lt;= ord(s[1]) &lt;= ord('h'):
        return [int(s[0]) - 1, ord(s[1]) - ord('a')]
                        </code>
                    </pre>
                </div>
                <div class="unagi">
                    <img src="https://Saito-Saito-Saito.github.io/reversi/unagi-yellow696969/question.JPG" alt="">
                    <div class="balloon">
                        <p>InBoard の中身が int とか -1 とかなってるけど<br>これどうなってんだ？</p>
                    </div>
                </div>
                <p>まず int(s) は char 型の s を int に変換しています。数字の比較をするためですね。</p>
                <p>引数の s はプレーヤーが入力したものをそのまま使うことを前提にしています。プレーヤーは 1 から 8 の数字を使って入力しますけれども、コードの中では<a href="https://Saito-Saito-Saito.github.io/memorandom/Python/list/#index_v" class="memo" target="_new">リストのインデックス</a>として用いるので、0 ~ 7 にしないといけません。そのために 1 を引いています。</p>
                <p>条件はもう一つ、アルファベットは a から h の 8 文字から選ばないといけません。それを確認しているのがこの部分ですね。</p>
                <div class="real-code">
                    <pre>
                        <code>
    elif s[0].isdecimal() and config.InBoard(int(s[0]) - 1) and <span style="font-weight: bold;">ord('a') &lt;= ord(s[1]) &lt;= ord('h')</span>:
        return [int(s[0]) - 1, ord(s[1]) - ord('a')]
                        </code>
                    </pre>
                </div>
                <p><a href="https://Saito-Saito-Saito.github.io/memorandom/Python/functions/#ord" class="memo" target="_new">ord 関数</a>は文字の Unicode をリターンする関数です。</p>
                <p>Unicode とは１文字に 1 つ割り振られた番号であり、特にアルファベットについてはアルファベット順に並んでいます。この性質を使えば、「Unicode が a から h の間」という条件で判別できますね。</p>
                <p>ここまで条件をクリアすれば、[<a href="https://Saito-Saito-Saito.github.io/reversi/memo/#row_v" class="memo" target="_new">row</a>, <a href="https://Saito-Saito-Saito.github.io/reversi/memo/#column_v" class="memo" target="_new">column</a>] の形でリターンします。</p>
                <div class="real-code">
                    <pre>
                        <code>
    elif s[0].isdecimal() and config.InBoard(int(s[0]) - 1) and ord('a') &lt;= ord(s[1]) &lt;= ord('h'):
        <span style="font-weight: bold;">return [int(s[0]) - 1, ord(s[1]) - ord('a')]</span>
                        </code>
                    </pre>
                </div>
                <div class="unagi">
                    <img src="https://Saito-Saito-Saito.github.io/reversi/unagi-yellow696969/question.JPG" alt="">
                    <div class="balloon">
                        <p>数字の int(s[0]) - 1 はまだいいにしてもさ、<br>アルファベットの方はなにやってんの？</p>
                    </div>
                </div>
                <p>アルファベットと<a href="https://Saito-Saito-Saito.github.io/memorandom/Python/list/#index_v" class="memo" target="_new">リストのインデックス</a>はこういう対応をしていますよね。</p>
                <table width="90%" cellpadding="10" border="1" style="max-width: 750px; margin: 0 5%; border: solid black 1px; border-collapse: collapse; text-align: center;">
                    <tr><td>a</td><td>b</td><td>c</td><td>d</td><td>e</td><td>f</td><td>g</td><td>h</td></tr>
                    <tr><td>0</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td></tr>
                </table>
                <p>先ほども申し上げたように、Unicode はアルファベット順に割り振られていますから、文字の Unicode から a の Unicode を引けば上の表の通りになりますよね。</p>
            </section>
            <p class="snake-line">~~~~~~~~~~~~~~~</p>
            <section class="sub-section">
                <p>2 文字目に数字が来た場合も全く同様にします。</p>
                <div class="real-code">
                    <pre>
                        <code>
    elif s[1].isdecimal() and config.InBoard(int(s[1]) - 1) and ord('a') &lt;= ord(s[0]) &lt;= ord('h'):
        return [int(s[1]) - 1, ord(s[0]) - ord('a')]
                        </code>
                    </pre>
                </div>
                <p>これ以外の条件ではマス目を特定できませんから、「解読失敗」config.FAILED をリターンしてあげましょう。</p>
                <div class="real-code">
                    <pre>
                        <code>
    else:
        local_logger.info('OUT OF FORMAT')
        return config.FAILED
                        </code>
                    </pre>
                </div>
            </section>
        </section>

        <section>
            <p><a href="https://Saito-Saito-Saito.github.io/reversi/stage7/section4/index.html">NEXT　7-4　ゲームセット後の操作を実装する</a></p>
        </section>
    </main>
    
    <footer>
        <ul>
            <li>LAST UPDATE: 2020/12/23</li>
            <li><a href="https://Saito-Saito-Saito.github.io" target="_blank">解説一覧</a></li>
            <li><a href="https://github.com/Saito-Saito-Saito" target="_blank">このページの作成者の GitHub</a></li>
            <li><a href="https://twitter.com/zsops_n" target="_blank">このページの作成者の Twitter</a></li>
            <li><a href="#">トップへ</a></li>
        </ul>
    </footer>
</body>
</html>