<html lang="ja">
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-166967736-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-166967736-1');
    </script>
    
    <title>Pythonプログラミングでチェスを作る 7-4</title>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta property="og:url" content="https://Saito-Saito-Saito.github.io/chess/stage7/section4">
    <meta property="og:title" content="Pythonプログラミングでチェスを作る 7-4">
    <meta name="og:description" content="Pythonプログラミングによって、ターミナル上で棋譜を使って実行できるチェスのゲームで、棋譜に書かれることの少ない移動元のマスのヒントとなる情報を整理します。">
    <meta name="description" content="Pythonプログラミングによって、ターミナル上で棋譜を使って実行できるチェスのゲームで、棋譜に書かれることの少ない移動元のマスのヒントとなる情報を整理します。">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="twitter:card" content="summary_large_image">
    <meta property="og:image" content="https://Saito-Saito-Saito.github.io/unagi-study.JPG">
    <meta name="google-site-verification" content="d3cz5KLnsS_25m1Shebvuyb3C4FfyoFNlPXdQ3z_oXg" />

    <link rel="icon" href="https://Saito-Saito-Saito.github.io/icon.png">
    <link rel="stylesheet" href="https://Saito-Saito-Saito.github.io/chess/stylesheet.css">
</head>
<body>
    <header>
        <img src="../../unagi-top.png" alt="" width="90px">
        <div id="title">
            <h1>Pythonプログラミングで</h1>
            <h1>チェスを作る</h1>
        </div>
    </header>

    <div id="menu-bar">
        <div id="short-menu">
            <input type="checkbox" id="acd-check">
            <table>
                <tr><td><a href="https://Saito-Saito-Saito.github.io/chess">HOME</a></td><td><label for="acd-check">STAGES</label></td><td><a href="https://Saito-Saito-Saito.github.io/chess/code">CODE</a></td></tr>
            </table>
            <ul class="stages-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage1/index.html">Stage 1　プログラムの機能を考える</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage2/index.html">Stage 2　プログラムの土台を作る</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage3/index.html">Stage 3　盤面のクラスの基本機能を作る</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage4/index.html">Stage 4　駒の動きを判定する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage5/index.html">Stage 5　駒を動かす</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage6/index.html">Stage 6　勝敗を判定する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage7/index.html">Stage 7　入力の棋譜を駒の動きに変換する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage8/index.html">Stage 8　ゲームを進行する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage9/index.html">Stage 9　ゲーム進行を記録する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage10/index.html">Stage 10　記録からゲームを進める</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage11/index.html">Stage 11　全体の機能を統括する</a></li>
            </ul>
        </div>
        <div id="long-menu">
            <table>
                <tr>
                    <td><a href="https://Saito-Saito-Saito.github.io/chess/">HOME</a></td>
                    <td><label for="acd-check1">Stage 1</label></td>
                    <td><label for="acd-check2">Stage 2</label></td>
                    <td><label for="acd-check3">Stage 3</label></td>
                    <td><label for="acd-check4">Stage 4</label></td>
                    <td><label for="acd-check5">Stage 5</label></td>
                    <td><label for="acd-check6">Stage 6</label></td>
                    <td><label for="acd-check7">Stage 7</label></td>
                    <td><label for="acd-check8">Stage 8</label></td>
                    <td><label for="acd-check9">Stage 9</label></td>
                    <td><label for="acd-check10">Stage 10</label></td>
                    <td><label for="acd-check11">Stage 11</label></td>
                    <td><a href="https://Saito-Saito-Saito.github.io/chess/code">CODE</a></td>
                </tr>
            </table>
            <input type="checkbox" id="acd-check1" class="acd-check">
            <ul id="s1-menu" class="sections-menu">
                <li><span><a href="https://Saito-Saito-Saito.github.io/chess/stage1/index.html">Stage 1　プログラムの機能を考える</a></span></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage1/section1/index.html">1-1　盤面の機能を考える</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage1/section2/index.html">1-2　駒の機能を考える</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage1/section3/index.html">1-3　運営の機能を考える</a></li>
            </ul>
            <input type="checkbox" id="acd-check2" class="acd-check">
            <ul id="s2-menu" class="sections-menu">
                <li><span><a href="https://Saito-Saito-Saito.github.io/chess/stage2/index.html">Stage 2　プログラムの土台を作る</a></span></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage2/section1/index.html">2-1　ロガーを設定する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage2/section2/index.html">2-2　定数を設定する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage2/section3/index.html">2-3　インデックスが適正か判定する機能を設定する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage2/section4/index.html">2-4　文字を変換する機能を設定する</a></li>
            </ul>
            <input type="checkbox" id="acd-check3" class="acd-check">
            <ul id="s3-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage3/index.html">Stage 3　盤面のクラスの基本機能を作る</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage3/section1/index.html">3-1　コンストラクタを作る</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage3/section2/index.html">3-2　盤面を表示する</a></li>
            </ul>
            <input type="checkbox" id="acd-check4" class="acd-check">
            <ul id="s4-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage4/index.html">Stage 4　駒の動きを判定する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage4/section1/index.html">4-1　全ての駒で不可能な動きを除外する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage4/section2/index.html">4-2　ポーンの動きを判定する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage4/section3/index.html">4-3　ルーク・ナイト・ビショップ・クイーンの動きを判定する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage4/section4/index.html">4-4　キングの動きを判定する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage4/section5/index.html">4-5　駒を飛び越える動きを除外する</a></li>
            </ul>
            <input type="checkbox" id="acd-check5" class="acd-check">
            <ul id="s5-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage5/index.html">Stage 5　駒を動かす</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage5/section1/index.html">5-1　動かせない場合を除外する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage5/section2/index.html">5-2　キャスリングの例外処理をする</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage5/section3/index.html">5-3　アンパッサンの例外処理をする</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage5/section4/index.html">5-4　プロモーションの例外処理をする</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage5/section5/index.html">5-5　駒を動かす</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage5/section6/index.html">5-6　パラメーター処理をする</a></li>
            </ul>
            <input type="checkbox" id="acd-check6" class="acd-check">
            <ul id="s6-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage6/index.html">Stage 6　勝敗を判定する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage6/section1//index.html">6-1　キングの位置を特定する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage6/section2/index.html">6-2　チェックの数を数える</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage6/section3/index.html">6-3　チェックメイト・ステイルメイトを判定する</a></li>
            </ul>
            <input type="checkbox" id="acd-check7" class="acd-check">
            <ul id="s7-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage7/index.html">Stage 7　入力の棋譜を駒の動きに変換する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage7/section1/index.html">7-1　不要な文字を消去する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage7/section2/index.html">7-2　正規表現でふるいにかける</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage7/section3/index.html">7-3　動かす駒を判定する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage7/section4/index.html">7-4　移動元のマスのヒントを整理する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage7/section5/index.html">7-5　移動先とプロモーションを特定する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage7/section6/index.html">7-6　移動元の候補を列挙する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage7/section7/index.html">7-7　移動元の候補を絞り込む</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage7/section8/index.html">7-8　キャスリングの棋譜を処理する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage7/section9/index.html">7-9　勝敗の棋譜を処理する</a></li>
            </ul>
            <input type="checkbox" id="acd-check8" class="acd-check">
            <ul id="s8-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage8/index.html">Stage 8　ゲームを進行する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage8/section1/index.html">8-1　ゲームの初期設定をする</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage8/sectino2/index.html">8-2　ゲームセットを判定する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage8/section3/index.html">8-3　駒の動きを入力する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage8/section4/index.html">8-4　ヘルプを処理する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage8/section5.index.html">8-5　リザインを処理する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage8/section6/index.html">8-6　盤上で駒を動かす</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage8/section7/index.html">8-7　ゲームセットを処理する</a></li>
            </ul>
            <input type="checkbox" id="acd-check9" class="acd-check">
            <ul id="s9-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage9/index.html">Stage 9　ゲーム進行を記録する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage9/section1/index.html">9-1　記録ファイルの初期設定をする</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage9/section2/index.html">9-2　棋譜から余計な文字を削除する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage9/section3/index.html">9-3　記録ファイルに棋譜を書き込む</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage9/section4/index.html">9-4　ゲームで記録機能を運用する</a></li>
            </ul>
            <input type="checkbox" id="acd-check10" class="acd-check">
            <ul id="s10-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage10/index.html">Stage 10　記録からゲームを進める</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage10/section1/index.html">10-1　記録ファイルを読み込む</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage10/section2/index.html">10-2　棋譜の内容を解読する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage10/section3/index.html">10-3　１手戻る機能を実装する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage10/sectino4/index.html">10-4　棋譜からゲームを再現する機能を実装する</a></li>
            </ul>
            <input type="checkbox" id="acd-check11" class="acd-check">
            <ul id="s11-menu" class="sections-menu">
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage11/index.html">Stage 11　全体の機能を統括する</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage11/section1/index.html">11-1　各種設定を変更させる</a></li>
                <li><a href="https://Saito-Saito-Saito.github.io/chess/stage11/section2/index.html">11-2　ウェルカムページを作る</a></li>
            </ul>
        </div>
    </div>

    <main>
        <section id="s7-4">
            <h1>Stage 7　入力の棋譜を駒の動きに変換する</h1>
            <h2>7-4　移動元のマスのヒントを整理する</h2>
            <section class="sub-section">
                <p>動かす駒の次に現れる可能性があるのが移動元の <a href="https://Saito-Saito-Saito.github.io/chess/memo/#file_v" class="memo" target="_new">file</a> もしくは <a href="https://Saito-Saito-Saito.github.io/chess/memo/#rank_v" class="memo" target="_new">rank</a> を表す英数字です。基本は両方とも書いてませんし、あってもどちらか一方です。ということで、「ない方が自然、あった場合に備える」というスタンスで解読していきます。</p>
                <div class="real-code">
                    <pre>
                        <code>
            # written info of what rank the piece comes from; frRANK starts from 0, but written No. is from 1
            if line[0].isdecimal():
                frFILE = OVERSIZE
                frRANK = IO.ToggleType(line[0]) - 1
                # deleting the number so that the sentence seems simpler
                line = line.lstrip(line[0])
            # written info of what file the piece comes from; frFILE starts from 0, but written No. is from 1
            elif ord('a') &lt;= ord(line[0]) &lt;= ord('h') and ord('a') &lt;= ord(line[1]) &lt;= ord('x'):
                frFILE = IO.ToggleType(line[0]) - 1
                frRANK = OVERSIZE
                # deleting only the first character of line
                line = line[1:]
            # nothing is written about where the piece comes from
            else:
                frFILE = OVERSIZE
                frRANK = OVERSIZE
            logger.info('FR = {}, {}'.format(frFILE, frRANK))
                        </code>
                    </pre>
                </div>
                <p><a href="https://Saito-Saito-Saito.github.io/chess/memo/#file_v" class="memo" target="_new">file</a> や <a href="https://Saito-Saito-Saito.github.io/chess/memo/#rank_v" class="memo" target="_new">rank</a> が指定されていればそれぞれ frFILE, frRANK の各変数に格納しますが、指定がなければ共に OVERSIZE が入ります。</p>
                <div class="unagi">
                    <img src="../../unagi-purple483d8b/normal.JPG" alt="UNAVAILABLE">
                    <div class="balloon">
                        <p>どして？</p>
                    </div>
                </div>
                <p>できれば frFILE にも frRANK にも具体的な値を入れたいのですが、棋譜に値が書いていない以上それができないじゃないですか。でも「書いていない」ってどうやって表します？</p>
                <div class="unagi">
                    <img src="../../unagi-purple483d8b/normal.JPG" alt="UNAVAILABLE">
                    <div class="balloon">
                        <p>盤上にない値を使えば書いてないってことをあらわせるんか</p>
                    </div>
                </div>
                <p>その通りです。</p>
            </section>
            <p class="snake-line">~~~~~~~~~~~~~~~</p>
            <section class="sub-section">
                <p>まずは面倒の少ない <a href="https://Saito-Saito-Saito.github.io/chess/memo/#rank_v" class="memo" target="_new">rank</a> の場合から。<a href="../section3/index.html" target="_new">7-3</a> の処理ですでに駒を表す文字については削除されていますから、移動元の <a href="https://Saito-Saito-Saito.github.io/chess/memo/#rank_v" class="memo" target="_new">rank</a> について指定があるときは line の先頭が数字です。</p>
                <div class="unagi">
                    <img src="../../unagi-purple483d8b/normal.JPG" alt="UNAVAILABLE">
                    <div class="balloon">
                        <p>ホントに？お？ホントか？</p>
                    </div>
                </div>
                <p>そんなに疑うならみてみましょうか。まずテキトーに <a href="../section2/index.html" target="_new">7-2</a> の<a href="https://Saito-Saito-Saito.github.io/memorandom/Python/re" class="memo" target="_new">正規表現</a>に適合する棋譜を考えます。</p>
                <div class="unagi">
                    <img src="../../unagi-purple483d8b/normal.JPG" alt="UNAVAILABLE">
                    <div class="balloon">
                        <p>Q5xh6 とかにしてみよか</p>
                    </div>
                </div>
                <p><a href="../section3/index.html" target="_new">7-3</a> で駒の種類を表す文字を削除していますよね。</p>
                <div class="unagi">
                    <img src="../../unagi-purple483d8b/normal.JPG" alt="UNAVAILABLE">
                    <div class="balloon">
                        <p>5xh6 になったな</p>
                    </div>
                </div>
                <p>もし最初に考えた棋譜が移動元の <a href="https://Saito-Saito-Saito.github.io/chess/memo/#rank_v" class="memo" target="_new">rank</a> を指定するものだったら、数字が先頭にきてるはずですよ。そうでなければ先頭は小文字のアルファベットですね。</p>
                <div class="unagi">
                    <img src="../../unagi-purple483d8b/normal.JPG" alt="UNAVAILABLE">
                    <div class="balloon">
                        <p>ホントだ</p>
                    </div>
                </div>
            </section>
            <p class="snake-line">~~~~~~~~~~~~~~~</p>
            <section class="sub-section">
                <p>そこで line[0] について「数字かどうか」<a href="https://Saito-Saito-Saito.github.io/memorandom/Python/str#isdecimal" class="memo" target="_new">isdecimal</a> を実行し、True であればそこで指定されている rank 番号を frRANK に格納します。</p>
                <div class="real-code">
                    <pre>
                        <code>
            # written info of what rank the piece comes from; frRANK starts from 0, but written No. is from 1
            <span style="font-weight: bold;">if line[0].isdecimal():
                frFILE = OVERSIZE
                frRANK = IO.ToggleType(line[0]) - 1</span> 
                # deleting the number so that the sentence seems simpler
                line = line.lstrip(line[0])
                        </code>
                    </pre>
                </div>
                <p>ToggleType の変換機能では、入力された数字をそのまま int にする以上に仕事しません。frRANK は<a href="https://Saito-Saito-Saito.gothub.io/memorandom/Python/list/#index_v" class="memo" target="_new">インデックス</a>として使うので、-1 して 0 スタートにするのを忘れないこと。また <a href="https://Saito-Saito-Saito.github.io/chess/memo/#file_v" class="memo" target="_new">file</a> は指定なしですから、規定値は OVERSIZE です。</p>
            </section>
            <p class="snake-line">~~~~~~~~~~~~~~~</p>
            <section class="sub-section">
                <p>最後に line を簡略化するために今解読した先頭文字を消去しておきます。</p>
                <div class="real-code">
                    <pre>
                        <code>
            # written info of what file the piece comes from; frFILE starts from 0, but written No. is from 1
            if line[0].isdecimal():
                frFILE = OVERSIZE
                frRANK = IO.ToggleType(line[0]) - 1
                # deleting the number so that the sentence seems simpler
                <span style="font-weight: bold;">line = line.lstrip(line[0])</span> 
                        </code>
                    </pre>
                </div>
                <p>直後に同じ文字が出現することはない(駒をとったことを表す "x" もしくは <a href="https://Saito-Saito-Saito.github.io/chess/memo/#file_v" class="memo" target="_new">file</a> を表すアルファベットが数字に先行)ため、<a href="https://Saito-Saito-Saito.github.io/memorandom/Python/str#lstrip" class="memo" target="_new">lstrip</a> をつかいます。</p>
                <div class="unagi">
                    <img src="../../unagi-purple483d8b/normal.JPG" alt="UNAVAILABLE">
                    <div class="balloon">
                        <p>先頭に数字が 2 つ連続で並ばないから「何文字も消える」ってことがないわけな</p>
                    </div>
                </div>
            </section>
            <p class="snake-line">~~~~~~~~~~~~~~~</p>
            <section class="sub-section">
                <p>次は <a href="https://Saito-Saito-Saito.github.io/chess/memo/#file_v" class="memo" target="_new">file</a> が指定されている場合です。<a href="https://Saito-Saito-Saito.github.io/chess/memo/#file_v" class="memo" target="_new">file</a> 指定のときは直後にもう一度アルファベットが続きます。</p>
                <div class="unagi">
                    <img src="../../unagi-purple483d8b/question.JPG" alt="UNAVAILABLE">
                    <div class="balloon">
                        <p>ホントに？</p>
                    </div>
                </div>
                <p>これもしっかり検証してみましょう。適当に棋譜を考えて <a href="../section2/index.html" target="_new">7-2</a> の<a href="https://Saito-Saito-Saito.github.io/memorandom/Python/re" class="memo" target="_new">正規表現</a>、<a href="../section3/index.html" target="_new">7-3</a> で考えた先頭の大文字の消去、先ほど実装した先頭の数字の消去を潜らせます。</p>
                <div class="unagi">
                    <img src="../../unagi-purple483d8b/normal.JPG" alt="UNAVAILABLE">
                    <div class="balloon">
                        <p>Bcxd4　→　cxd4</p>
                    </div>
                </div>
                <p>移動元の <a href="https://Saito-Saito-Saito.github.io/chess/memo/#file_v" class="memo" target="_new">file</a> をしていた場合は先頭に小文字のアルファベットが２文字以上並んでますよね。しかもその２文字は</p>
                <p>
                    <ul>
                        <li>1 文字目が a-h</li>
                        <li>2 文字目が a-x</li>
                    </ul>
                </p>
                <p>という組み合わせになっているはずです。</p>
                <div class="unagi">
                    <img src="../../unagi-purple483d8b/normal.JPG" alt="UNAVAILABLE">
                    <div class="balloon">
                        <p>ホントだ</p>
                    </div>
                </div>
                <p>ですから、これを条件として移動元の <a href="https://Saito-Saito-Saito.github.io/chess/memo/#file_v" class="memo" target="_new">file</a> が指定されているか判断します。</p>
            </section>
            <p class="snake-line">~~~~~~~~~~~~~~~</p>
            <section class="sub-section">
                <p>コードをみてみましょう。先ほどの条件でまずは if (elif) 文を作ります。</p>
                <div class="real-code">
                    <pre>
                        <code>
            # written info of what file the piece comes from; frFILE starts from 0, but written No. is from 1
            <span style="font-weight: bold;">elif ord('a') &lt;= ord(line[0]) &lt;= ord('h') and ord('a') &lt;= ord(line[1]) &lt;= ord('x'):</span>
                frFILE = IO.ToggleType(line[0]) - 1
                frRANK = OVERSIZE
                # deleting only the first character of line
                line = line[1:]
                        </code>
                    </pre>
                </div>
                <p>条件文中でやることは <a href="https://Saito-Saito-Saito.github.io/chess/memo/#rank_v" class="memo" target="_new">rank</a> 指定の時とほぼ変わりません。frFILE に ToggleType を使って指定 <a href="https://Saito-Saito-Saito.github.io/chess/memo/#file_v" class="memo" target="_new">file</a> 番号を 0 スタートで格納し、frRANK には指定なし OVERSIZE を入れておきます。</p>
                <div class="real-code">
                    <pre>
                        <code>
            # written info of what file the piece comes from; frFILE starts from 0, but written No. is from 1
            elif ord('a') &lt;= ord(line[0]) &lt;= ord('h') and ord('a') &lt;= ord(line[1]) &lt;= ord('x'):
                <span style="font-weight: bold;">frFILE = IO.ToggleType(line[0]) - 1
                frRANK = OVERSIZE</span>
                # deleting only the first character of line
                line = line[1:]
                        </code>
                    </pre>
                </div>
                <p>ここからが問題。<a href="https://Saito-Saito-Saito.github.io/chess/memo/#file_v" class="memo" target="_new">file</a> 指定の場合、先ほども申し上げた通り 1 文字目と 2 文字目にアルファベットが連続します。そして時には同じ文字が連続することもあります。</p>
                <div class="unagi">
                    <img src="../../unagi-purple483d8b/question.JPG" alt="UNAVAILABLE">
                    <div class="balloon">
                        <p>そんなことあんの</p>
                    </div>
                </div>
                <p>ありますよ。例えば Qgg1 とか。</p>
                <img src="which-queen.png" alt="UNAVAILABLE" width="90%" style="max-width: 400px;">
                <div class="unagi">
                    <img src="../../unagi-purple483d8b/normal.JPG" alt="UNAVAILABLE">
                    <div class="balloon">
                        <p>Qgg1　→　gg1<br>ホントだ</p>
                    </div>
                </div>
                <p>もし同じ文字が連続しているときに「先頭と違う文字が出るまで削除し続ける」<a href="https://Saito-Saito-Saito.github.io/memorandom/Python/str#lstrip" class="memo" target="_new">lstrip</a> を発動すると、移動先の <a href="https://Saito-Saito-Saito.github.io/chess/memo/#file_v" class="memo" target="_new">file</a> を示す 2 文字目のアルファベットまで消失してしまいます。ですからここでは「line の 2 文字目以降を line に再代入」</p>
                <div class="real-code">
                    <pre>
                        <code>
                frFILE = IO.ToggleType(line[0]) - 1
                frRANK = OVERSIZE
                # deleting only the first character of line
                <span style="font-weight: bold;">line = line[1:]</span> 
                        </code>
                    </pre>
                </div>
                <p>しているのです。</p>
                <div class="unagi">
                    <img src="../../unagi-purple483d8b/normal.JPG" alt="UNAVAILABLE">
                    <div class="balloon">
                        <p>rank の時もそうすりゃよかったじゃん</p>
                    </div>
                </div>
                <p>まあそれを言われればおしまいですけど。</p>
            </section>
            <p class="snake-line">~~~~~~~~~~~~~~~</p>
            <section class="sub-section">
                <p><a href="https://Saito-Saito-Saito.github.io/chess/memo/#file_v" class="memo" target="_new">file</a> も <a href="https://Saito-Saito-Saito.github.io/chess/memo/#rank_v" class="memo" target="_new">rank</a> も指定されていない「その他」の場合は frFILE, frRANK 共に OVERSIZE です。</p>
                <div class="real-code">
                    <pre>
                        <code>
            # nothing is written about where the piece comes from
            else:
                frFILE = OVERSIZE
                frRANK = OVERSIZE
            logger.info('FR = {}, {}'.format(frFILE, frRANK))
                        </code>
                    </pre>
                </div>
                <p>繰り返しになりますが、ふつう両方とも OVERSIZE になります。</p>
            </section>
            <p class="snake-line">~~~~~~~~~~~~~~~</p>
            <section class="sub-section">
                <p>次いで「相手の駒をとっているか」を判読します。ここまで来れば line から移動元の情報は全て削除され "x" が line 先頭まで来ていますから、line[0] == "x" によって場合分けが可能です。</p>
                <div class="real-code">
                    <pre>
                        <code>
            # whether the piece has captured one of the opponent's pieces
            <span style="font-weight: bold;">if line[0] == 'x':</span>
                CAPTURED = True
                line = line.lstrip(line[0])
            else:
                CAPTURED = False
                        </code>
                    </pre>
                </div>
                <p>駒をとっていれば新たな変数 CAPTURED を True に、そうでなければ False にします。この後のために x は <a href="https://Saito-Saito-Saito.github.io/memorandom/Python/str#lstrip" class="memo" target="_new">lstrip</a> で消しておきましょう。</p>
            </section>


        </section>
        
        <section>
            <p><a href="../section5/index.html">NEXT　7-5　移動先とプロモーションを特定する</a></p>
        </section>
    </main>

    <footer>
        <ul>
            <li>LAST UPDATE: 2020/12/23</li>
            <li><a href="https://Saito-Saito-Saito.github.io" target="_blank">解説一覧</a></li>
            <li>
                <a href="https://github.com/Saito-Saito-Saito" target="_blank">このページの作成者のGitHub</a>
            </li>
            <li>
                <a href="https://twitter.com/zsops_n" target="_blank">このページの作成者のTwitter</a>
            </li>
            <li>
                <a href="#">トップに戻る</a>
            </li>
        </ul>
    </footer>

    
</body>
</html>